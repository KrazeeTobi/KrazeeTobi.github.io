<HTML>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
   <META NAME="GENERATOR" CONTENT="Mozilla/4.04 [en] (Win95; I) [Netscape]">
   <TITLE>Concatenation</TITLE>
</HEAD>
<BODY>
<A NAME="Top"></A><A HREF="cpp.html">Contents</A>|<A HREF="cppindex.html">Index</A>|<A HREF="cppStringification.html">Previous</A>|<A HREF="cppUndefining_Macros.html">Next</A>
<BR><A NAME="off_427042"></A><A NAME="e6232ea4"></A><A NAME="off_427042"></A><A NAME="e6232ea4"></A><A NAME="off_427042"></A><A NAME="e6232ea4"></A><A NAME="off_427042"></A><A NAME="e6232ea4"></A><A NAME="off_427042"></A><A NAME="e6232ea4"></A><A NAME="off_427042"></A><A NAME="e6232ea4"></A><A NAME="off_427042"></A><A NAME="e6232ea4"></A><A NAME="off_427042"></A><A NAME="e6232ea4"></A><A NAME="off_427042"></A><A NAME="e6232ea4"></A><A NAME="off_427042"></A><A NAME="e6232ea4"></A><A NAME="off_427042"></A><A NAME="e6232ea4"></A><FONT FACE="Futura Md BT"><FONT COLOR="#000000"><B><FONT SIZE=+3>Concatenation&nbsp;</FONT></B>&nbsp;</FONT></FONT>
<HR SIZE=6 WIDTH="100%">
<BR><FONT FACE="Times New Roman"><FONT COLOR="#000000"><FONT SIZE=+1><I>Concatenation</I>
means joining two strings into one. In the context of macro expansion,
concatenation refers to joining two lexical units into one longer one.
Specifically, an actual argument to the macro can be concatenated with
another actual argument or with fixed text to produce a longer name. The
longer name might be the name of a function, variable or type, or a C keyword;
it might even be the name of another macro, in which case it will be expanded.</FONT></FONT></FONT>

<P><FONT COLOR="#000000"><FONT FACE="Times New Roman"><FONT SIZE=+1>When
you define a macro, you request concatenation with the special operator
</FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>##</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
in the macro body. When the macro is called, after actual arguments are
substituted, all </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>##</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
operators are deleted, and so is any whitespace next to them (including
whitespace that was part of an actual argument). The result is to concatenate
the syntactic tokens on either side of the </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>##</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>.
Consider a C program that interprets named commands. There probably needs
to be a table of commands, perhaps an array of structures declared as follows.</FONT></FONT></FONT>
<UL>
<PRE><FONT FACE="Courier New"><FONT SIZE=+1>struct command&nbsp;
{&nbsp;
&nbsp;&nbsp; char *name;&nbsp;
&nbsp;&nbsp; void (*function) ();&nbsp;
};&nbsp;

struct command commands[] =&nbsp;
{&nbsp;
&nbsp;&nbsp; <FONT COLOR="#000000">{ "quit", quit_command},&nbsp;
&nbsp;&nbsp; { "help", help_command},&nbsp;
. . .&nbsp;
};</FONT></FONT></FONT></PRE>
</UL>
<FONT COLOR="#000000"><FONT FACE="Times New Roman"><FONT SIZE=+1>It would
be cleaner not to have to give each command name twice, once in the string
constant and once in the function name. A macro which takes the name of
a command as an argument can make this unnecessary. The string constant
can be created with stringification, and the function name by concatenating
the argument with </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>_command</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>.
What follows is an example of how it is done.</FONT></FONT></FONT>
<UL>
<PRE><FONT FACE="Courier New"><FONT SIZE=+1>#define COMMAND(NAME)&nbsp;&nbsp; { #NAME, NAME ## _command }&nbsp;

struct command commands[] =&nbsp;
{&nbsp;
&nbsp;&nbsp; COMMAND (quit),&nbsp;
&nbsp;&nbsp; COMMAND (help),&nbsp;
&nbsp;&nbsp; . . .&nbsp;
};</FONT></FONT></PRE>
</UL>
<FONT COLOR="#000000"><FONT FACE="Times New Roman"><FONT SIZE=+1>The usual
case of concatenation is concatenating two names (or a name and a number)
into a longer name. But this isn’t the only valid case. It is also possible
to concatenate two numbers (or a number and a name, such as </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>1.5</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
and </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>e3</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>)
into a number. Also, multi-character operators such as </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>+=</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
can be formed by concatenation. In some cases it is even possible to piece
together a string constant. However, two pieces of text that don’t together
form a valid lexical unit cannot be concatenated. For example, concatenation
with </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>x</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
on one side and </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>+</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
on the other is not meaningful because those two characters can’t fit together
in any lexical unit of C. The ANSI standard says that such attempts at
concatenation are undefined, but in the GNU C preprocessor it is well defined:
it puts </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>x</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
and </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>+</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
side by side with no particular special results.</FONT></FONT></FONT>

<P><FONT COLOR="#000000"><FONT FACE="Times New Roman"><FONT SIZE=+1>Keep
in mind that the C preprocessor converts comments to whitespace before
macros are even considered. Therefore, you cannot create a comment by concatenating
</FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>/</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
and </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>*</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>:
the </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>/*</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
sequence that starts a comment is not a lexical unit, but rather the beginning
of a “long” space character. Also, you can freely use comments next to
</FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>##</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
in a macro definition, or in actual arguments that will concatenate, because
the comments will be convert to spaces at first sight, and concatenation
will later discard the spaces.</FONT></FONT></FONT>
<BR>
<HR SIZE=3 WIDTH="100%">
<CENTER><A HREF="#Top">Top</A>|<A HREF="cpp.html">Contents</A>|<A HREF="cppindex.html">Index</A>|<A HREF="cppStringification.html">Previous</A>|<A HREF="cppUndefining_Macros.html">Next</A></CENTER>

</BODY>
</HTML>
