<HTML>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
   <META NAME="GENERATOR" CONTENT="Mozilla/4.04 [en] (Win95; I) [Netscape]">
   <TITLE>Labels as Values</TITLE>
</HEAD>
<BODY>
<A NAME="Top"></A><A HREF="gcc.html">Contents</A>|<A HREF="gccindex.html">Index</A>|<A HREF="gccLocally_Declared_Labels.html">Previous</A>|<A HREF="gccNested_Functions.html">Next</A>
<BR><FONT FACE="Futura Md BT"><FONT COLOR="#000000">&nbsp;<A NAME="off_3246477"></A><A NAME="2a642181"></A><B><FONT SIZE=+3>Labels
as values&nbsp;</FONT></B>&nbsp;</FONT></FONT>&nbsp;
<HR SIZE=6 WIDTH="100%">
<BR><FONT FACE="Times New Roman"><FONT SIZE=+1>You can get the address
of a label defined in the current function (or a containing function) with
the unary operator, ‘</FONT></FONT><B><FONT FACE="Courier New"><FONT SIZE=+0>&amp;&amp;</FONT></FONT></B><FONT FACE="Times New Roman"><FONT SIZE=+1>’.
The value has type </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>void
</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>‘</FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>*</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>’.
This value is a constant and can be used wherever a constant of that type
is valid.</FONT></FONT>

<P><FONT FACE="Times New Roman"><FONT SIZE=+1>Use the following example,
for instance.</FONT></FONT>
<UL>
<PRE><FONT FACE="Courier New"><FONT SIZE=+1>void *ptr;&nbsp;
...&nbsp;
ptr = &amp;&amp;foo;</FONT></FONT></PRE>
</UL>
<FONT FACE="Times New Roman"><FONT SIZE=+1>To use these values, you need
to be able to jump to one. This is done with the computed </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>goto</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
statement, </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>goto *
exp;</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1> as in </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>goto
*ptr;</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>. The analogous
feature in FORTRAN is called an assigned </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>goto</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>,
but that name seems inappropriate in C, where one can do more than simply
store label addresses in label variables.</FONT></FONT>

<P><FONT FACE="Times New Roman"><FONT SIZE=+1>Any expression of type </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>void
*</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1> is allowed.</FONT></FONT>

<P><FONT FACE="Times New Roman"><FONT SIZE=+1>One way of using these constants
is in initializing a static array that will serve as a jump table:</FONT></FONT>
<UL>
<PRE><FONT FACE="Courier New"><FONT SIZE=+1>static void *array[] = { &amp;&amp;foo, &amp;&amp;bar, &amp;&amp;hack };</FONT></FONT></PRE>
</UL>
<FONT FACE="Times New Roman"><FONT SIZE=+1>Then you can select a label
with indexing, as in the following example.</FONT></FONT>
<UL>
<PRE><FONT FACE="Courier New"><FONT SIZE=+1>goto *array[i];.</FONT></FONT></PRE>
<FONT FACE="Times New Roman"><FONT SIZE=+1><I>Note</I>:</FONT></FONT>
<BR><FONT FACE="Times New Roman"><FONT SIZE=+1>This does not check whether
the subscript is in bounds—array indexing in C never does that.</FONT></FONT></UL>
<FONT FACE="Times New Roman"><FONT SIZE=+1>Such an array of label values
serves a purpose much like that of the switch statement. The </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>switch</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
statement is cleaner, so use that rather than an array unless the problem
does not fit a </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>switch</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
statement very well.</FONT></FONT>

<P><FONT FACE="Times New Roman"><FONT SIZE=+1>Another use of label values
is in an interpreter for threaded code. The labels within the interpreter
function can be stored in the threaded code for super-fast dispatching.</FONT></FONT>

<P><FONT FACE="Times New Roman"><FONT SIZE=+1>You can use this mechanism
to jump to code in a different function. If you do that, totally unpredictable
things will happen. The best way to avoid this is to store the label address
only in automatic variables and never pass it as an argument.</FONT></FONT>&nbsp;
<HR SIZE=3 WIDTH="100%">
<CENTER><A HREF="#Top">Top</A>|<A HREF="gcc.html">Contents</A>|<A HREF="gccindex.html">Index</A>|<A HREF="gccLocally_Declared_Labels.html">Previous</A>|<A HREF="gccNested_Functions.html">Next</A></CENTER>

</BODY>
</HTML>
