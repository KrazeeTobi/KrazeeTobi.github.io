<HTML>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
   <META NAME="GENERATOR" CONTENT="Mozilla/4.04 [en] (Win95; I) [Netscape]">
   <TITLE> Cross-development environment</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF">

<DIV CLASS="ChapterTitle"><A NAME="Top"></A><A HREF="gsTOC.html">Contents</A>|<A HREF="gsIX.html">Index</A>|<A HREF="int04.html">Previous</A>|<A HREF="int05.html">Next</A></DIV>

<DIV CLASS="ChapterTitle"><A NAME="pgfId=1003010"></A><A NAME="16571"></A><B><FONT FACE="Futura Md BT"><FONT COLOR="#000000"><FONT SIZE=+3>Cross-development
environment&nbsp;
<HR SIZE=6 WIDTH="100%"><A NAME="pgfId=1008491"></A></FONT></FONT></FONT></B><FONT SIZE=+1>Using
GNUPro Toolkit in one of the&nbsp;<A NAME="marker=1008625"></A>cross-development
configurations usually requires some attention to setting up the target
environment.</FONT></DIV>
<A NAME="pgfId=1008492"></A><FONT SIZE=+1>A cross-development configuration
can develop software for a different target machine than the development
tools themselves (which run on the host)--for example, a SPARCstation can
generate and debug code for a Motorola Power PC-based board.</FONT>
<BR><A NAME="pgfId=1008493"></A><FONT SIZE=+1>For our tools to work with
a target environment (except for real-time operating systems, which provide
full operating system support), set up the tools by using the following
documentation.</FONT>
<UL TYPE=SQUARE>
<LI CLASS="Body">
<A NAME="pgfId=1008496"></A><FONT SIZE=+1>To set up the&nbsp;<A NAME="marker=1008626"></A>C
run-time environment, see <A HREF="#The_C_run-time_environment_(crt0)" CLASS="XRef">The
C run-time environment (<TT>crt0</TT>)</A>.</FONT></LI>

<LI CLASS="Body">
<A NAME="pgfId=1008498"></A><FONT SIZE=+1>To create <B><I>stubs<A NAME="marker=1008627"></A></I></B>,
or minimal versions of operating system&nbsp;<A NAME="marker=1008628"></A><I>subroutines</I>
<I>for the&nbsp;<A NAME="marker=1008629"></A>C subroutine library</I>,
see <A HREF="../4_libs/a_GNUPro_C_Library/libcSystem_Calls.html">System
calls</A> in <I><A HREF="../4_libs/a_GNUPro_C_Library/libc.html">GNUPro
C Library</A></I> in&nbsp; <B><I>GNUPro Libraries</I></B>.</FONT></LI>

<LI CLASS="Body">
<A NAME="pgfId=1008720"></A><FONT SIZE=+1>To understand the connection
to the debugger, see <A HREF="../3_dbug/b_Debugging_with_GDB/gdbRemote_debugging.html">Remote
debugging</A> in <I><A HREF="../3_dbug/b_Debugging_with_GDB/gdb.html">Debugging
with GDB</A></I> in <B><I>GNUPro Debugging Tools</I></B>.</FONT></LI>
</UL>

<DIV CLASS="Heading1"><A NAME="pgfId=1008506"></A><A NAME="The_C_run-time_environment_(crt0)"></A><FONT SIZE=+2><B><I><FONT FACE="Times New Roman,Times">The
C run-time environment (<A NAME="26645"></A></FONT></I></B><TT>crt0</TT><B><I><FONT FACE="Times New Roman,Times">)</FONT></I></B></FONT></DIV>

<BR>&nbsp;
<DIV CLASS="Body"><A NAME="pgfId=1008507"></A><FONT SIZE=+1>To link and
run C or C++ programs, you need to define a small module (usually written
in assembler as '<TT>crt0.s<A NAME="marker=1008630"></A></TT>') that makes
sure the hardware is initialized for C conventions before calling <TT>main</TT>.</FONT></DIV>

<DIV CLASS="Body"><A NAME="pgfId=1008508"></A><FONT SIZE=+1>There are some
examples of <TT>crt0.s</TT> code (along with examples of system call stub
code) available in the source code for GNUPro Toolkit.&nbsp;<A NAME="pgfId=1008509"></A>Look
in the following path.</FONT></DIV>

<UL>
<UL>
<PRE CLASS="Body"><A NAME="pgfId=1008510"></A><FONT SIZE=+1><I>installdir</I> /gnupro-98r1/src/newlib/libc/sys</FONT></PRE>
</UL>
</UL>

<DIV CLASS="Body"><A NAME="pgfId=1008511"></A><FONT SIZE=+1><I><TT>installdir</TT></I>
refers to your installation directory, by default '<TT>/usr/cygnus</TT>'.</FONT></DIV>

<DIV CLASS="Body"><A NAME="pgfId=1008512"></A><FONT SIZE=+1>For example,
look in '<TT>.../sys/h8300hms</TT>' for Hitachi H8/300 bare boards, or
in '<TT>.../sys/sparclite</TT>' for the Fujitsu SPARClite board.</FONT></DIV>

<DIV CLASS="Body"><A NAME="pgfId=1008513"></A><FONT SIZE=+1>More examples
are in the following directory.</FONT></DIV>

<UL>
<UL>
<PRE CLASS="CodeExample"><A NAME="pgfId=1008514"></A><FONT SIZE=+1><I>installdir</I> /gnupro-98r1/src/newlib/stub</FONT></PRE>
</UL>
</UL>

<DIV CLASS="CodeExample"><A NAME="pgfId=1008515"></A><FONT SIZE=+1>To write
your own <TT>crt0.s </TT>module, you need the following information about
your target.</FONT></DIV>

<UL TYPE=SQUARE>
<LI CLASS="Body">
<A NAME="pgfId=1008516"></A><FONT SIZE=+1>A memory map. What memory is
available, and where?</FONT></LI>

<LI CLASS="Body">
<A NAME="pgfId=1008517"></A><FONT SIZE=+1>Which way does the stack grow?</FONT></LI>

<LI CLASS="Body">
<A NAME="pgfId=1008598"></A><FONT SIZE=+1>What output format do you use?</FONT></LI>
</UL>

<DIV CLASS="Body"><A NAME="pgfId=1008599"></A><FONT SIZE=+1>At a minimum,
your <TT>crt0.s</TT> module must do the following processes.</FONT></DIV>

<UL TYPE=SQUARE>
<LI CLASS="Body">
<A NAME="pgfId=1008600"></A><FONT SIZE=+1><B><I>Define the symbol, </I></B><TT>start</TT><B><I>
(</I></B><TT>_start</TT><B><I> in assembler code).</I></B></FONT></LI>

<BR><FONT SIZE=+1>Execution begins at this symbol.</FONT>
<LI CLASS="Body">
<A NAME="pgfId=1008521"></A><FONT SIZE=+1><B><I>Set up the stack pointer,
</I></B><TT>sp</TT><B><I>.</I></B></FONT></LI>

<BR><FONT SIZE=+1>It is largely up to you to choose where to store your
stack within the constraints of your target's memory map. Perhaps the simplest
choice is to choose a fixed-size area somewhere in the uninitialized data
section (often called '<TT>bss</TT>'). Remember that whether you choose
the low address or the high address in this area depends on the direction
your stack grows.</FONT>
<LI CLASS="Body">
<A NAME="pgfId=1008522"></A><FONT SIZE=+1><B><I>Initialize all memory in
the uninitialized-data (</I></B><TT>bss</TT><B><I>) section to zero.</I></B></FONT></LI>

<BR><A NAME="pgfId=1008523"></A><FONT SIZE=+1>The easiest way to do this
is with the help of a linker script (see <A HREF="../5_ut/b_Usingld/ldLinker_scripts.html">Linker
scripts</A> in <A HREF="../5_ut/b_Usingld/ld.html"><I>Using </I><TT>ld</TT></A>
in <B><I>GNUPro Utilities</I></B>). Use a linker script to define symbols
such as '<TT>bss_start</TT> ' and&nbsp; '<TT>bss_end</TT>' to record the
boundaries of this section; then you can use a&nbsp; '<TT>for</TT>' loop
to initialize all memory between them in the&nbsp; '<TT>crt0.s</TT>' module.</FONT>
<LI CLASS="Body">
<A NAME="pgfId=1008524"></A><FONT SIZE=+1><B><I>Call </I></B><TT>main<A NAME="marker=1008631"></A></TT><B><I>.</I></B></FONT></LI>

<BR><FONT SIZE=+1>Nothing else will<B><I>!</I></B></FONT></UL>

<DIV CLASS="Body"><A NAME="pgfId=1008525"></A><FONT SIZE=+1>A more complete
<TT>crt0.s</TT> module might also do the following processes.</FONT></DIV>

<UL TYPE=SQUARE>
<LI CLASS="Body">
<A NAME="pgfId=1008526"></A><FONT SIZE=+1><B><I>Define an&nbsp; </I></B><TT>_exit</TT><B><I>
subroutine.</I></B></FONT></LI>

<BR><FONT SIZE=+1>This is the C name; in your assembler code. Use the label,
<TT>__exit</TT>, with two leading underbars. Its precise behavior depends
on the details of your system, and on your choice. Possibilities include
trapping back to the boot monitor, if there is one; or to the&nbsp;<A NAME="marker=1008633"></A>loader,
if there is no monitor; or even back to the symbol, <TT>start</TT>.</FONT>
<LI CLASS="Body">
<A NAME="pgfId=1008527"></A><B><I><FONT SIZE=+1>If your target has no monitor
to mediate communications with the debugger, you must set up the hardware&nbsp;<A NAME="marker=1008632"></A>exception
handler in the&nbsp; </FONT></I></B><FONT SIZE=+1><TT>crt0.s</TT><I> module.</I></FONT></LI>

<BR><FONT SIZE=+1>See <A HREF="../3_dbug/b_Debugging_with_GDB/gdbThe_GDB_remote_serial_protocol.html">The
<TT>gdb</TT> remote serial protocol</A> in <I><A HREF="../3_dbug/b_Debugging_with_GDB/gdb.html">Debugging
with GDB</A></I> in <B><I>GNUPro Debugging Tools</I></B> for details on
how to use the <TT>gdb</TT> generic remote-target facilities for this purpose.</FONT>
<LI CLASS="Body">
<A NAME="pgfId=1008528"></A><B><I><FONT SIZE=+1>Perform other hardware-dependent
initialization.</FONT></I></B></LI>

<BR><FONT SIZE=+1>For example, initialize an <TT>mmu</TT> or an auxiliary
floating-point chip.</FONT>
<LI CLASS="Body">
<A NAME="pgfId=1008529"></A><B><I><FONT SIZE=+1>Define low-level input
and output subroutines.</FONT></I></B></LI>

<BR><FONT SIZE=+1>For example, the '<TT>crt0.s</TT>' module is a convenient
place to define the minimal assembly-level routines described in <A HREF="../4_libs/a_GNUPro_C_Library/libcSystem_Calls.html">System
calls</A> in <I><A HREF="../4_libs/a_GNUPro_C_Library/libc.html">GNUPro
C Library</A></I> in <B><I>GNUPro Libraries</I></B>.</FONT></UL>

<DIV CLASS="BodyListFollow">
<HR SIZE=6 WIDTH="100%">
<CENTER><A HREF="#Top">Top</A>|<A HREF="gsTOC.html">Contents</A>|<A HREF="gsIX.html">Index</A>|<A HREF="int04.html">Previous</A>|<A HREF="int05.html">Next</A></CENTER>
</DIV>

</BODY>
</HTML>
