<HTML>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
   <META NAME="GENERATOR" CONTENT="Mozilla/4.04 [en] (Win95; I) [Netscape]">
   <TITLE>Macros with Variable Numbers of Arguments</TITLE>
</HEAD>
<BODY>
<A NAME="Top"></A><A HREF="gcc.html">Contents</A>|<A HREF="gccindex.html">Index</A>|<A HREF="gccArrays_of_Variable_Length.html">Previous</A>|<A HREF="gccNonLvalue_Arrays_May_Have_Subscr.html">Next</A>
<BR><A NAME="off_3443501"></A><A NAME="fc6c17b5"></A><FONT FACE="Futura Md BT"><FONT COLOR="#000000"><B><FONT SIZE=+3>Macros
with variable numbers of arguments&nbsp;</FONT></B>&nbsp;</FONT></FONT>&nbsp;
<HR SIZE=6 WIDTH="100%">
<BR><FONT FACE="Times New Roman"><FONT SIZE=+1>In GNU C, a macro can accept
a variable number of arguments, much as a function can. The syntax for
defining the macro looks much like that used for a function. The following
is an example.</FONT></FONT>
<UL>
<PRE><FONT FACE="Courier New"><FONT SIZE=+1>#define eprintf(format, args...)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \&nbsp;
&nbsp;fprintf (stderr, format , ## args)</FONT></FONT></PRE>
</UL>
<FONT FACE="Courier New"><FONT SIZE=+0>args</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
is a rest argument: it takes in zero or more arguments, as many as the
call contains. All of them plus the commas between them form the value
of </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>args</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>,
which is substituted into the macro body where </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>args</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
is used. Thus, we have the following expansion.</FONT></FONT>
<UL>
<PRE><FONT FACE="Courier New"><FONT SIZE=+1>eprintf ("%s:%d: ", input_file_name, line_number)&nbsp;
</FONT></FONT><B><FONT FACE="ZapfDingbats"><FONT SIZE=+2>&aring;&nbsp;
</FONT></FONT></B><FONT FACE="Courier New"><FONT SIZE=+1>fprintf (stderr, "%s:%d: ", input_file_name, line_number)</FONT></FONT></PRE>

<UL><FONT FACE="Times New Roman"><FONT SIZE=+1><I>Note</I>:</FONT></FONT>
<BR><FONT FACE="Times New Roman"><FONT SIZE=+1>The comma after the string
constant comes from the definition of </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>eprintf</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>,
whereas the last comma comes from the value of </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>args</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>.</FONT></FONT></UL>
</UL>
<FONT FACE="Times New Roman"><FONT SIZE=+1>The reason for using ‘</FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>##</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>’
is to handle the case when </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>args</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
matches no arguments at all. In this case, </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>args</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
has an empty value. In this case, the second comma in the definition becomes
an embarrassment: if it got through to the expansion of the macro, we would
get something like the following.</FONT></FONT>
<UL>
<PRE><FONT FACE="Courier New"><FONT SIZE=+1>fprintf (stderr, "success!\n" , )</FONT></FONT></PRE>
</UL>
<FONT FACE="Times New Roman"><FONT SIZE=+1>The previous example shows invalid
C syntax. ‘</FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>##</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>’
gets rid of the comma, so, instead, we get the following.</FONT></FONT>
<UL>
<PRE><FONT FACE="Courier New"><FONT SIZE=+1>fprintf (stderr, "success!\n")</FONT></FONT></PRE>
</UL>
<FONT FACE="Times New Roman"><FONT SIZE=+1>This is a special feature of
the GNU C preprocessor: ‘</FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>##</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>’
before a rest argument that is empty discards the preceding sequence of
non-whitespace characters from the macro definition. (If another macro
argument precedes, none of it is discarded.)</FONT></FONT>

<P><FONT FACE="Times New Roman"><FONT SIZE=+1>It might be better to discard
the last preprocessor token instead of the last preceding sequence of non-whitespace
characters; in fact, we may someday change this feature to do so. We advise
you to write the macro definition so that the preceding sequence of non-whitespace
characters is just a single token, so that the meaning will not change
if we change the definition of this feature.</FONT></FONT>&nbsp;
<HR SIZE=3 WIDTH="100%">
<CENTER><A HREF="#Top">Top</A>|<A HREF="gcc.html">Contents</A>|<A HREF="gccindex.html">Index</A>|<A HREF="gccArrays_of_Variable_Length.html">Previous</A>|<A HREF="gccNonLvalue_Arrays_May_Have_Subscr.html">Next</A></CENTER>

</BODY>
</HTML>
