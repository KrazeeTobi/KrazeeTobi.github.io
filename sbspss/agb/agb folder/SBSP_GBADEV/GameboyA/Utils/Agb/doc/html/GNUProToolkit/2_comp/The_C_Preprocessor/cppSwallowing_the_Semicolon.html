<HTML>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
   <META NAME="GENERATOR" CONTENT="Mozilla/4.04 [en] (Win95; I) [Netscape]">
   <TITLE>Swallowing the Semicolon</TITLE>
</HEAD>
<BODY>
<A NAME="Top"></A><A HREF="cpp.html">Contents</A>|<A HREF="cppindex.html">Index</A>|<A HREF="cppUnintended_Grouping_of_Arithmeti.html">Previous</A>|<A HREF="cppDuplication_of_Side_Effects.html">Next</A>
<BR><A NAME="off_524670"></A><A NAME="777c7989"></A><A NAME="off_524670"></A><A NAME="777c7989"></A><A NAME="off_524670"></A><A NAME="777c7989"></A><A NAME="off_524670"></A><A NAME="777c7989"></A><A NAME="off_524670"></A><A NAME="777c7989"></A><A NAME="off_524670"></A><A NAME="777c7989"></A><A NAME="off_524670"></A><A NAME="777c7989"></A><A NAME="off_524670"></A><A NAME="777c7989"></A><A NAME="off_524670"></A><A NAME="777c7989"></A><FONT FACE="Futura Md BT"><FONT COLOR="#000000"><FONT SIZE=+3><B>Swallowing
the semicolon&nbsp;</B>&nbsp;</FONT></FONT></FONT>
<HR SIZE=6 WIDTH="100%">
<BR><FONT COLOR="#000000"><FONT FACE="Times New Roman"><FONT SIZE=+1>Often
it is desirable to define a macro that expands into a compound statement.
Consider, for example, the following macro, that advances a pointer (the
argument, </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>p</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>,
says where to find it) across whitespace characters.</FONT></FONT></FONT>
<UL>
<PRE><FONT SIZE=+1><FONT FACE="Courier New">#define SKIP_SPACES (p, limit) \&nbsp;
{ register char *lim = (limit); \&nbsp;
&nbsp;&nbsp; while (p != lim) { \&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (*p++ != </FONT><FONT FACE="Times New Roman">’</FONT><FONT FACE="Courier New"> </FONT><FONT FACE="Times New Roman">’</FONT><FONT FACE="Courier New">) { \&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; p--; break; }}}</FONT></FONT></PRE>
<I><FONT FACE="Times New Roman"><FONT SIZE=+1>Note:</FONT></FONT></I>
<BR><FONT FACE="Times New Roman"><FONT SIZE=+1>Backslash-Newline is used
to split the macro definition, which must be a single line, so that it
resembles the way such C code would be laid out if not part of a macro
definition.</FONT></FONT></UL>
<FONT COLOR="#000000"><FONT FACE="Times New Roman"><FONT SIZE=+1>A call
to this macro might be </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>SKIP_SPACES
(p, lim)</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>. Strictly
speaking, the call expands to a compound statement, which is a complete
statement with no need for a semicolon to end it. But it looks like a function
call. So it minimizes confusion if to use it like a function call, writing
a semicolon afterward, as in the following example.</FONT></FONT></FONT>
<UL>
<PRE><FONT FACE="Courier New"><FONT SIZE=+1>SKIP_SPACES (p, lim);</FONT></FONT></PRE>
</UL>
<FONT COLOR="#000000"><FONT FACE="Times New Roman"><FONT SIZE=+1>But this
can cause trouble before </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>else</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
statements, because the semicolon is actually a null statement. Suppose
you have the following input.</FONT></FONT></FONT>
<UL>
<PRE><FONT FACE="Courier New"><FONT SIZE=+1>if (*p != 0)&nbsp;
&nbsp;&nbsp; SKIP_SPACES (p, lim);&nbsp;
else. . .</FONT></FONT></PRE>
</UL>
<FONT COLOR="#000000"><FONT FACE="Times New Roman"><FONT SIZE=+1>The presence
of two statements—the compound statement and a null statement—in between
the </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>if</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
condition and the </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>else</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
makes invalid C code. The definition of the macro, </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>SKIP_SPACES</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>,
can be altered to solve this problem, using a </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>do
... while</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1> statement.
Use the following input as an example.</FONT></FONT></FONT>
<UL>
<PRE><FONT SIZE=+1><FONT FACE="Courier New">#define SKIP_SPACES (p, limit) \&nbsp;
do { register char *lim = (limit); \&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (p != lim) { \&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (*p++ != </FONT><FONT FACE="Times New Roman">’</FONT><FONT FACE="Courier New"> </FONT><FONT FACE="Times New Roman">’</FONT><FONT FACE="Courier New">) { \&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; p--; break; }}} \&nbsp;
while (0)</FONT></FONT></PRE>
</UL>
<FONT COLOR="#000000"><FONT FACE="Times New Roman"><FONT SIZE=+1>Now </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>SKIP_SPACES
(p, lim);</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1> expands
into one output statement as the following example shows.</FONT></FONT></FONT>
<UL>
<PRE><B><FONT FACE="Courier New"><FONT SIZE=+1>do { : : :&nbsp;
} while (0);</FONT></FONT></B></PRE>
</UL>

<HR SIZE=3 WIDTH="100%">
<CENTER><A HREF="#Top">Top</A>|<A HREF="cpp.html">Contents</A>|<A HREF="cppindex.html">Index</A>|<A HREF="cppUnintended_Grouping_of_Arithmeti.html">Previous</A>|<A HREF="cppDuplication_of_Side_Effects.html">Next</A></CENTER>

</BODY>
</HTML>
