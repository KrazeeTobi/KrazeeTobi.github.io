<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Author" content="Frederick Geers">
   <meta name="GENERATOR" content="Mozilla/4.51 [en] (Win95; I) [Netscape]">
   <title>The C run-time environment (crt0)</title>
</head>
<body>
<a NAME="Top"></a><a href="emb.html">Contents</a>|<a href="embindex.html">Index</a>|<a href="embCross_dev_environ.html">Previous</a>|<a href="embcrt0_the_main_startup_file.html">Next</a>
<br><font size=+2><font face="Futura Md BT">The C run-time environment
(</font><b><font face="Courier New,Courier">crt0</font></b><font face="Futura Md BT">)</font></font>
<hr SIZE=5 WIDTH="100%">
<br><font size=+1>To link and run C or C++ programs,&nbsp; you need to
define a small module (usually written in assembler as ‘<tt>crt0.s</tt>’)
to ensure that the hardware initializes for C conventions before calling
main.</font><font size=+1></font>
<p><font size=+1>There are some examples available in the sources of GNUPro
Toolkit for ‘<tt>crt0.s</tt>’ code (along with examples of system calls
with sub-routines).</font>
<br><font size=+1>Look in the following path.</font>
<blockquote><tt><font size=+1><i>installdir</i>/gnupro-99r1/src/newlib/libc/sys</font></tt></blockquote>
<font size=+1><i><tt>installdir&nbsp;</tt></i> refers to your installation
directory, by default ‘<tt>/usr/cygnus</tt>’.</font>
<br><font size=+1>For example, look in ‘<tt>.../sys/h8300hms</tt>’ for
Hitachi H8/300 bare boards, or in ‘<tt>.../sys/sparclite</tt>’ for the
Fujitsu SPARClite board.</font>
<br><font size=+1>More examples are in the following directory.</font>
<blockquote><tt><font size=+1><i>installdir</i>/gnupro-98r2/src/newlib/stub</font></tt></blockquote>
<font size=+1>To write your own <tt>crt0.s</tt> module, you need the following
information about your target.</font>
<ul TYPE=SQUARE>
<li>
<font size=+1>A memory map, showing the size of available memory and memory
location</font></li>

<li>
<font size=+1>Which way the stack grows</font></li>

<li>
<font size=+1>Which output format is in use</font></li>
</ul>
<font size=+1>At a minimum, your <tt>crt0.s</tt> module must do the following
processes.</font>
<ul TYPE=SQUARE>
<li>
<font size=+1>Define the symbol, <tt>start</tt> (<tt>_start</tt> in assembler
code). Execution begins at this symbol.</font></li>
</ul>

<ul TYPE=SQUARE>
<li>
<font size=+1>Set up the stack pointer, <tt>sp</tt>. It is largely up to
you to choose where to store your stack within the constraints of your
target’s memory map. Perhaps the simplest choice is to choose a fixed-size
area somewhere in the uninitialized data section (often called ‘bss’).
Remember that whether you choose the low address or the high address in
this area depends on the direction your stack grows.</font></li>
</ul>

<ul TYPE=SQUARE>
<li>
<font size=+1>Initialize all memory in the uninitialized-data (‘bss’) section
to zero.</font></li>
<font size=+1></font>
<p><br><font size=+1>The easiest way to do this is with the help of a linker
script (see “<a href="../5_ut/b_Usingld/ldLinker_scripts.html">Linker scripts</a>”
in <a href="../5_ut/b_Usingld/ld.html"><i>Using </i><tt>ld</tt></a> in
<b><i>GNUPro Utilities</i></b>). Use a linker script to define symbols
such as ‘<tt>bss_start</tt>’ and ‘<tt>bss_end</tt>’ to record the boundaries
of this section; then you can use a ‘<tt>for</tt>’ loop to initialize all
memory between them in the ‘<tt>crt0.s</tt>’ module.</font>
<br><font size=+1></font>&nbsp;
<li>
<font size=+1>Call <tt>main</tt>. Nothing else will!</font></li>
</ul>
<font size=+1>A more complete ‘<tt>crt0.s</tt>’ module might also do the
following processes.</font>
<ul TYPE=SQUARE>
<li>
<font size=+1>Define an ‘<tt>_exit</tt>’ subroutine. This is the C name;
in your assembler code.&nbsp; Use the label, <tt>_ _exit</tt>, with two
leading underbars. Its precise behavior depends on the details of your
system, and on your choice. Possibilities include trapping back to the
boot monitor, if there is one; or to the loader, if there is no monitor;
or even back to the symbol, <tt>start</tt>.</font></li>
</ul>

<ul TYPE=SQUARE>
<li>
<font size=+1>If your target has no monitor to mediate communications with
the debugger, you must set up the hardware exception handler in the ‘<tt>crt0.s</tt>’
module. See <a href="../3_dbug/b_Debugging_with_GDB/gdbThe_GDB_remote_serial_protocol.html">The
GDB remote serial protocol</a> in <i><a href="../3_dbug/b_Debugging_with_GDB/gdb.html">Debugging
with GDB</a></i> in <b><i>GNUPro Debugging Tools</i></b> for details on
how to use the GDB generic remote-target facilities for this purpose.</font></li>
</ul>

<ul TYPE=SQUARE>
<li>
<font size=+1>Perform other hardware-dependent initialization; for example,
initializing an <tt>mmu</tt> or an auxiliary floating-point chip.</font></li>
</ul>

<ul TYPE=SQUARE>
<li>
<font size=+1>Define low-level input and output subroutines. For example,
the ‘<tt>crt0.s</tt>’ module is a convenient place to define the minimal
assembly-level routines; see <a href="../4_libs/a_GNUPro_C_Library/libcSystem_Calls.html">System
calls</a> in <i><a href="../4_libs/a_GNUPro_C_Library/libc.html">GNUPro
C Library</a></i> in <b><i>GNUPro Libraries</i></b>.</font></li>
</ul>

<hr SIZE=5 WIDTH="100%">
<center><a href="#Top">Top</a>|<a href="emb.html">Contents</a>|<a href="embindex.html">Index</a>|<a href="embCross_dev_environ.html">Previous</a>|<a href="embcrt0_the_main_startup_file.html">Next</a></center>

</body>
</html>
