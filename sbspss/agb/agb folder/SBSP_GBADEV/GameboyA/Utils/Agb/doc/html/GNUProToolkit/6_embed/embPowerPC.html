<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.51 [en] (Win95; I) [Netscape]">
   <title> </title>
</head>
<body bgcolor="#FFFFFF">
<a NAME="Top"></a><a href="emb.html">Contents</a>|<a href="embindex.html">Index</a>|<a href="embV850.html">Previous</a>|<a href="embSPARC_targets.html">Next</a>
<div CLASS="ChapterTitle"><font face="Futura Md BT"><font color="#000000"><font size=+3>PowerPC
development</font></font></font></div>

<div CLASS="BodyAfterHead">
<hr SIZE=3 WIDTH="100%"><font size=+1>The following documentation discusses
cross-development with the PowerPC targets.</font></div>

<ul>
<ul>
<ul>
<li CLASS="Bullet">
<font size=+1><a href="#Compiling_for_PowerPC" CLASS="XRef">Compiling for
PowerPC targets</a></font></li>

<ul>
<li CLASS="Bullet">
<font size=+1><a href="#PPC_floating-point_subroutines">Floating-point
subroutines for PowerPC targets</a></font></li>

<li CLASS="Bullet">
<font size=+1><a href="#Preprocessor_macros">Preprocessor macro for PowerPC
targets</a></font></li>
</ul>

<li CLASS="Bullet">
<font size=+1><a href="#PPC_assembler_options" CLASS="XRef">Assembler options
for PowerPC targets</a></font></li>

<li CLASS="Bullet">
<font size=+1><a href="#PPC_debugging" CLASS="XRef">Debugging PowerPC targets</a></font></li>

<ul>
<li CLASS="Bullet">
<font size=+1><a href="#PPC_stack_frame">The stack frame</a></font></li>

<li CLASS="Bullet">
<font size=+1><a href="#PPC_stack_argument">Argument passing</a></font></li>

<li CLASS="Bullet">
<font size=+1><a href="#PPC_Function_return_value">Function return values</a></font></li>
</ul>
</ul>
</ul>
</ul>

<div CLASS="Body"><font size=+1>Cross-development tools in the GNUPro Toolkit
are normally installed with names that reflect the target machine, so that
you can install more than one set of tools in the same binary directory.
The target name, constructed with the <tt>--target</tt> option to <tt>configure</tt>
, is used as a prefix to the program name. For example, the compiler for
the PowerPC<tt> </tt>(<tt>gcc</tt> in native configurations) is called,
depending on which configuration you have installed, by <tt>powerpc-eabi-gcc</tt>.</font></div>

<div CLASS="Body"><font size=+1>The following processors are supported
for the PowerPC targets.</font></div>

<table>
<tr>
<td>
<div CLASS="CellBody">
<ul>
<ul><tt><font size=+1>403Gx&nbsp;</font></tt></ul>
</ul>
</div>
</td>

<td>
<div CLASS="CellBody"><tt><font size=+1>603(e)&nbsp;</font></tt></div>
</td>
</tr>

<tr>
<td>
<div CLASS="CellBody">
<ul>
<ul><tt><font size=+1>505&nbsp;</font></tt></ul>
</ul>
</div>
</td>

<td>
<div CLASS="CellBody"><tt><font size=+1>604&nbsp;</font></tt></div>
</td>
</tr>

<tr>
<td>
<div CLASS="CellBody">
<ul>
<ul><tt><font size=+1>601&nbsp;</font></tt></ul>
</ul>
</div>
</td>

<td>
<div CLASS="CellBody"><tt><font size=+1>604(e)&nbsp;</font></tt></div>
</td>
</tr>

<tr>
<td>
<div CLASS="CellBody">
<ul>
<ul><tt><font size=+1>602&nbsp;</font></tt></ul>
</ul>
</div>
</td>

<td>
<div CLASS="CellBody"><tt><font size=+1>821&nbsp;</font></tt></div>
</td>
</tr>

<tr>
<td>
<div CLASS="CellBody">
<ul>
<ul><tt><font size=+1>603&nbsp;</font></tt></ul>
</ul>
</div>
</td>

<td>
<div CLASS="CellBody"><tt><font size=+1>860&nbsp;</font></tt></div>
</td>
</tr>
</table>

<div CLASS="Heading1"><a NAME="Compiling_for_PowerPC"></a><b><i><font face="Times New Roman,Times"><font size=+2>Compiling
for PowerPC targets</font></font></i></b></div>

<div CLASS="Body"><font size=+1>The PowerPC target family toolchain controls
variances in code generation directly from the command line.</font></div>

<div CLASS="Body"><font size=+1>When you run <tt>gcc</tt>, you can use
command-line options to choose whether to take advantage of the extra PowerPC
machine instructions, and whether to generate code for hardware or software
floating point.</font></div>

<div CLASS="Body"><font size=+1>When you run <tt>gcc</tt>, you can use
command-line options to choose machine-specific details.</font></div>

<div CLASS="Body"><font size=+1>The following <tt>-m</tt> options are defined
for the PowerPC.</font></div>

<ul>
<div CLASS="BodyHang1"><tt><font size=+1>-mpower</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mno-power</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mpower2</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mno-power2</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mpowerpc</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mno-powerpc</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mpowerpc-gpopt</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mno-powerpc-gpopt</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mpowerpc-gfxopt</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mno-powerpc-gfxopt</font></tt></div>

<ul><font size=+1>GNU CC supports two related instruction set architectures
for the IBM RS/6000 and PowerPC. The POWER instruction set are those instructions
supported by the <tt>rios</tt> chip set used in the original RS/6000 systems
and the PowerPC instruction set is the architecture of the Motorola MPC5<i>xx</i>,
MPC6<i>xx</i>, MCP8<i>xx</i> and the IBM 4<i>xx</i> microprocessors. The
PowerPC architecture defines 64-bit instructions, but they are not supported
by any current processors.</font></ul>

<ul>
<div CLASS="BodyListFollow"><font size=+1>Neither architecture is a subset
of the other. However there is a large common subset of instructions supported
by both. An MQ register is included in processors supporting the POWER
architecture.</font></div>
</ul>

<ul>
<div CLASS="BodyListFollow"><font size=+1>You use these options to specify
which instructions are available on the processor you are using. The default
value of these options is determined when configuring GNU CC. Specifying
the <tt>-mcpu=<i>cpu_type</i></tt> overrides the specification of these
options.</font></div>
</ul>

<ul>
<div CLASS="BodyListFollow"><font size=+1>We recommend you use the <tt>-mcpu=<i>cpu_type</i></tt>
option rather than any of these options.</font></div>

<div CLASS="BodyListFollow"><font size=+1>The <tt>-mpower </tt>option allows
GNU CC to generate instructions that are found only in the POWER architecture
and to use the MQ register. Specifying <tt>-mpower2 </tt>implies <tt>-power
</tt>and
also allows GNU CC to generate instructions that are present in the POWER2
architecture but not the original POWER architecture.</font></div>

<div CLASS="BodyListFollow"><font size=+1>The <tt>-mpowerpc </tt>option
allows GNU CC to generate instructions that are found only in the 32-bit
subset of the PowerPC architecture. Specifying <tt>-mpowerpc-gpopt </tt>implies
<tt>-mpowerpc
</tt>and
also allows GNU CC to use the optional PowerPC architecture instructions
in the General Purpose group, including floating-point square root. Specifying
<tt>-mpowerpc-gfxopt
</tt>implies
<tt>-mpowerpc </tt>and also allows GNU CC to use the optional PowerPC architecture
instructions in the Graphics group, including floating-point select.</font></div>

<div CLASS="BodyListFollow"><font size=+1>If you specify both <tt>-mno-power
</tt>and
<tt>-mno-powerpc
</tt>,
GNU CC will use only the instructions in the common subset of both architectures
plus some special AIX common-mode calls, and will not use the MQ register.
Specifying both <tt>-mpower </tt>and
<tt>-mpowerpc
</tt>permits GNU CC
to use any instruction from either architecture and to allow use of the
MQ register; specify this for the Motorola MPC601.</font></div>
</ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mnew-mnemonics</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mold-mnemonics</font></tt></div>

<ul><font size=+1>Select which mnemonics to use in the generated assembler
code.</font>
<div CLASS="BodyListFollow"><font size=+1><tt>-mnew-mnemonics</tt> requests
output that uses the assembler mnemonics defined for the PowerPC architecture,
while <tt>-mold-mnemonics</tt> requests the assembler mnemonics defined
for the POWER architecture. Instructions defined in only one architecture
have only one mnemonic; GNU CC uses that mnemonic irrespective of which
of these options is specified.</font></div>

<div CLASS="BodyListFollow"><font size=+1>PowerPC assemblers support both
the old and new mnemonics, as will later POWER assemblers. Current POWER
assemblers only support the old mnemonics. Specify <tt>-mnew-mnemonics
</tt>if
you have an assembler that supports them, otherwise specify <tt>-mold-mnemonics</tt>
.</font></div>

<div CLASS="BodyListFollow"><font size=+1>The default value of these options
depends on how GNU CC was configured. Specifying <tt>-mcpu=<i>cpu_type</i></tt>
sometimes overrides the value of these option. Unless you are building
a cross-compiler, you should normally not specify either <tt>-mnew-mnemonics</tt>
or <tt>-mold-mnemonics</tt> , but should instead accept the default.</font></div>
</ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mcpu=<i>cpu_type</i></font></tt></div>

<ul><font size=+1>Set architecture type, register usage, choice of mnemonics,
and instruction scheduling parameters for machine type, <i><tt>cpu_type</tt></i>.
Supported values for <i><tt>cpu_type</tt></i> are <tt>rs6000</tt>, <tt>rios1</tt>,
<tt>rios2</tt>,
<tt>rsc</tt>,
<tt>601</tt>,
<tt>602</tt>, <tt>603</tt>,
<tt>603e</tt>,
<tt>604</tt>,
<tt>604e</tt>,
<tt>620</tt>, <tt>power</tt>,
<tt>power2</tt>,
<tt>powerpc</tt>,
<tt>403</tt>,
<tt>505</tt>, <tt>801</tt>,
<tt>821</tt>,
<tt>823</tt>, <tt>860</tt> and
<tt>common</tt>.</font></ul>

<ul>
<div CLASS="BodyListFollow"><font size=+1>The <tt>-mcpu=power</tt>, <tt>-mcpu=power2</tt>,
and <tt>-mcpu=powerpc</tt> specify generic POWER, POWER2 and pure PowerPC
(i.e., not MPC601) architecture machine types, with an appropriate, generic
processor model assumed for scheduling purposes.</font></div>

<div CLASS="BodyListFollow"><font size=+1>Specifying <tt>-mcpu=rios1</tt>,
<tt>-mcpu=rios2</tt>,
<tt>-mcpu=rsc</tt>,
<tt>-mcpu=power</tt>,
or <tt>-mcpu=power2</tt> enables the <tt>-mpower</tt> option and disables
the <tt>-mpowerpc</tt> option;
<tt>-mcpu=601</tt> enables both the <tt>-mpower</tt>
and <tt>-mpowerpc</tt> options; <tt>-mcpu=602</tt>,
<tt>-mcpu=603</tt>,
<tt>-mcpu=603e</tt>, <tt>-mcpu=604</tt>,
<tt>-mcpu=620</tt> ; <tt>-mcpu=403</tt>,
<tt>-mcpu=505</tt>, <tt>-mcpu=821</tt>,
<tt>-mcpu=860</tt> and <tt>-mcpu=powerpc</tt>
enable the <tt>-mpowerpc</tt> option and disable the <tt>-mpower</tt> option;
<tt>-mcpu=common</tt> disables both the <tt>-mpower</tt> and <tt>-mpowerpc</tt>
options.</font></div>

<div CLASS="BodyListFollow"><font size=+1>IBM AIX versions 4 or greater
selects <tt>-mcpu=common</tt> by default, so that code will operate on
all members of the IBM RS/6000 and PowerPC families. In that case, GNU
CC will use only the instructions in the common subset of both architectures
plus some special AIX common-mode calls, and will not use the MQ register.
GNU CC assumes a generic processor model for scheduling purposes.</font></div>

<div CLASS="BodyListFollow"><font size=+1>Specifying <tt>-mcpu=rios1</tt>,
<tt>-mcpu=rios2</tt>,
<tt>-mcpu=rsc</tt>,
<tt>-mcpu=power</tt>,
or <tt>-mcpu=power2
</tt>also disables the <tt>new-mnemonics</tt> option.</font></div>

<div CLASS="BodyListFollow"><font size=+1>Specifying <tt>-mcpu=601</tt>
, <tt>-mcpu=602</tt>, <tt>-mcpu=603</tt>,
<tt>-mcpu=603e</tt>, <tt>-mcpu=604</tt>
, <tt>-mcpu=620</tt>, <tt>-mcpu=403</tt>, or <tt>-mcpu=powerpc</tt> also
enables the <tt>new-mnemonics</tt> option.</font></div>

<div CLASS="BodyListFollow"><font size=+1>Specifying <tt>-mcpu=403</tt>
, <tt>-mcpu=821</tt>, or
<tt>-mcpu=860</tt> also enables the <tt>-msoft-float</tt>
option.</font></div>
</ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mtune=<i>cpu_type</i></font></tt></div>

<ul><font size=+1>Set the instruction scheduling parameters for machine
type, <i><tt>cpu_type</tt></i>, but do not set the architecture type, register
usage, choice of mnemonics like <tt>-mcpu=<i>cpu_type</i></tt> would. The
same values for <i><tt>cpu_type</tt></i> are used for <tt>-mtune=<i>cpu_type</i></tt>
as for <tt>-mcpu=<i>cpu_type</i></tt> . The <tt>-mtune=<i>cpu_type</i></tt>
option overrides the <tt>-mcpu=<i>cpu_type</i></tt> option in terms of
instruction scheduling parameters.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mfull-toc</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mno-fp-in-toc</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mno-sum-in-toc</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mminimal-toc</font></tt></div>

<ul><font size=+1>Modify generation of the TOC (Table Of Contents), which
is created for every executable file. The <tt>-mfull-toc</tt> option is
selected by default. In that case, GNU CC will allocate at least one TOC
entry for each unique non-automatic variable reference in your program.
GNU CC will also place floating-point constants in the TOC. However, only
16,384 entries are available in the TOC.</font></ul>

<ul>
<div CLASS="BodyListFollow"><font size=+1>If you receive a linker error
message that saying you have overflowed the available TOC space, you can
reduce the amount of TOC space used with the <tt>-mno-fp-in-toc</tt> and
<tt>-mno-sum-in-toc</tt>
options.</font></div>
</ul>

<ul>
<div CLASS="BodyListFollow"><font size=+1><tt>-mno-fp-in-toc</tt> prevents
GNU CC from putting floating-point constants in the TOC and <tt>-mno-sum-in-toc</tt>
forces GNU CC to generate code to calculate the sum of an address and a
constant at run-time instead of putting that sum into the TOC.</font>
<p><font size=+1>You may specify one or both of these options. Each causes
GNU CC to produce very slightly slower and larger code at the expense of
conserving TOC space.</font></div>

<div CLASS="BodyListFollow"><font size=+1>If you still run out of space
in the TOC even when you specify both of these options, specify <tt>-mminimal-toc</tt>
instead. This option causes GNU CC to make only one TOC entry for every
file. When you specify this option, GNU CC will produce code that is slower
and larger but which uses extremely little TOC space. You may wish to use
this option only on files that contain less frequently executed code.</font></div>
</ul>

<div CLASS="BodyHang1"><tt><font size=+1>-msoft-float</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mhard-float</font></tt></div>

<ul><font size=+1>Generate code that does not use or does use the floating-point
register set. Software floating point emulation is provided if you use
the <tt>-msoft-float</tt> option, and pass the option to GNU CC when linking.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mmultiple</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mno-multiple</font></tt></div>

<ul><font size=+1>Generate code that uses (does not use) the load multiple
word instructions and the store multiple word instructions. These instructions
are generated by default on POWER systems, and not generated on PowerPC
systems. Do not use <tt>-mmultiple</tt> on little endian PowerPC systems,
since those instructions do not work when the processor is in little endian
mode.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mstring</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mno-string</font></tt></div>

<ul><font size=+1>Generate code that uses (does not use) the load string
instructions and the store string word instructions to save multiple registers
and do small block moves. These instructions are generated by default on
POWER systems, and not generated on PowerPC systems.</font></ul>

<ul>
<div CLASS="Label">
<ul><i><font size=+1><b>Warning</b>:</font></i></ul>
</div>

<div CLASS="Note">
<ul><font size=+1>Do not use <tt>-mstring</tt> on little endian PowerPC
systems, since those instructions do not work when the processor is in
little endian mode.</font></ul>
</div>
</ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mupdate</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mno-update</font></tt></div>

<ul><font size=+1>Generate code that uses (or does not use) the load or
store instructions that update the base register to the address of the
calculated memory location. These instructions are generated by default.</font></ul>

<ul>
<div CLASS="BodyListFollow"><font size=+1>If you use <tt>-mno-update</tt>
, there is a small window between the time that the stack pointer is updated
and the address of the previous frame is stored, which means code that
walks the stack frame across interrupts or signals may get corrupted data.</font></div>
</ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mfused-madd</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mno-fused-madd</font></tt></div>

<ul><font size=+1>Generate code that uses (does not use) the floating point
multiply and accumulate instructions. These instructions are generated
by default if hardware floating is used.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mno-bit-align</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mbit-align</font></tt></div>

<ul><font size=+1>On System V.4 and embedded PowerPC systems do not and
do force structures and unions containing bit fields aligned to the base
type of the bit field. For example, by default a structure containing nothing
but 8 unsigned bitfields of length 1 would be aligned to a 4 byte boundary
and have a size of 4 bytes. By using <tt>-mno-bit-align</tt>, the structure
would be aligned to a 1 byte boundary and be one byte in size.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mno-strict-align</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mstrict-align</font></tt></div>

<ul><font size=+1>On System V.4 and embedded PowerPC systems do not (do)
assume that unaligned memory references will be handled by the system.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mrelocatable</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mno-relocatable</font></tt></div>

<ul><font size=+1>On embedded PowerPC systems generate code that allows
(does not allow) the program to be relocated to a different address at
runtime. If you use <tt>-mrelocatable</tt> on any module, all objects linked
together must be compiled with <tt>-mrelocatable</tt> or <tt>-mrelocatable-lib</tt>.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mrelocatable-lib</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mno-relocatable-lib</font></tt></div>

<ul><font size=+1>On embedded PowerPC systems generate code that allows
(does not allow) the program to be relocated to a different address at
runtime. Modules compiled with <tt>-mreloctable-lib</tt> can be linked
with either modules compiled without <tt>-mrelocatable</tt> and <tt>-mrelocatable-lib</tt>
or with modules compiled with the <tt>-mrelocatable</tt> options.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mno-toc</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mtoc</font></tt></div>

<ul><font size=+1>On System V.4 and embedded PowerPC systems do not (do)
assume that register 2 contains a pointer to a global area pointing to
the addresses used in the program.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mno-traceback</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mtraceback</font></tt></div>

<ul><font size=+1>On embedded PowerPC systems do not (do) generate a trace-back
tag before the start of the function. This tag can be used by the debugger
to identify where the start of a function is.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mlittle</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mlittle-endian</font></tt></div>

<ul><font size=+1>On System V.4 and embedded PowerPC systems compile code
for the processor in little endian mode. The <tt>-mlittle-endian</tt> option
is the same as <tt>-mlittle</tt> .</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mbig</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mbig-endian</font></tt></div>

<ul><font size=+1>On System V.4 and embedded PowerPC systems compile code
for the processor in big endian mode. The <tt>-mbig-endian</tt> option
is the same as <tt>-mbig</tt> .</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mcall-sysv</font></tt></div>

<ul><font size=+1>On System V.4 and embedded PowerPC systems compile code
using calling conventions that adheres to the March 1995 draft of the System
V Application Binary Interface, PowerPC processor supplement. This is the
default unless you configured GCC using <tt>powerpc-*-eabiaix</tt> .</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mcall-sysv-eabi</font></tt></div>

<ul><font size=+1>Specify both <tt>-mcall-sysv</tt> and <tt>-meabi</tt>
options.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mcall-sysv-noeabi</font></tt></div>

<ul><font size=+1>Specify both <tt>-mcall-sysv</tt> and <tt>-mnoeabi</tt>
options.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mcall-aix</font></tt></div>

<ul><font size=+1>On System V.4 and embedded PowerPC systems compile code
using calling conventions that are similar to those used on AIX. This is
the default if you configured GCC using <tt>powerpc-*-eabiaix</tt> .</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mcall-solaris</font></tt></div>

<ul><font size=+1>On System V.4 and embedded PowerPC systems, compile code
for the Solaris operating system.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mcall-linux</font></tt></div>

<ul><font size=+1>On System V.4 and embedded PowerPC systems, compile code
for the Linux operating system.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mprototype</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mno-prototype</font></tt></div>

<ul><font size=+1>On System V.4 and embedded PowerPC systems assume that
all calls to variable argument functions are properly prototyped. Otherwise,
the compiler must insert an instruction before every non prototyped call
to set or clear bit 6 of the condition code register (<tt>CR</tt>) to indicate
whether floating point values were passed in the floating point registers
in case the function takes a variable arguments.</font></ul>

<ul>
<div CLASS="BodyListFollow"><font size=+1>With <tt>-mprototype</tt>, only
calls to prototyped variable argument functions will set or clear the bit.</font></div>
</ul>

<div CLASS="BodyHang1"><tt><font size=+1>-msim</font></tt></div>

<ul><font size=+1>On embedded PowerPC systems, assume that the startup
module is called <tt>sim-crt0.o </tt>and the standard C libraries are <tt>libsim.a</tt>
and <tt>libc.a</tt>. This is default for <tt>powerpc-*-eabisim</tt> configurations.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mmvme</font></tt></div>

<ul><font size=+1>On embedded PowerPC systems, assume that the startup
module is called <tt>mvme-crt0.o</tt> and the standard C libraries are
<tt>libmvme.a</tt>
and <tt>libc.a</tt> .</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-memb</font></tt></div>

<ul><font size=+1>On embedded PowerPC systems, set the <tt>PPC_EMB</tt>
bit in the ELF flags header to indicate that <tt>eabi</tt> extended relocations
are used.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mads</font></tt></div>

<ul><font size=+1>On embedded PowerPC systems, assume that the startup
module is called <tt>crt0.o</tt> and the standard C libraries are <tt>libads.a</tt>
and <tt>libc.a </tt><i>.</i></font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-myellowknife</font></tt></div>

<ul><font size=+1>On embedded PowerPC systems, assume that the startup
module is called <tt>crt0.o</tt> and ` <tt>libyk.a</tt> and ` <tt>libc.a</tt>
are the standard C libraries.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-meabi</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mno-eabi</font></tt></div>

<ul><font size=+1>On System V.4 and embedded PowerPC systems do (do not)
adhere to the Embedded Applications Binary Interface (EABI) which is a
set of modifications to the System V.4 specifications. Selecting <tt>-meabi</tt>
means that the stack is aligned to an 8 byte boundary, a function, <tt>__eabi</tt>,
is called to from <tt>main</tt> to set up the EABI environment, and the
<tt>-msdata</tt>
option can use both <tt>r2</tt> and <tt>r13</tt> to point to two separate
small data areas.</font></ul>

<ul>
<div CLASS="BodyListFollow"><font size=+1>Selecting <tt>-mno-eabi</tt>
means that the stack is aligned to a 16 byte boundary, do not call an initialization
function from main, and the</font></div>
<font size=+1><tt>-msdata</tt> option will only use <tt>r13</tt> to point
to a single small data area. The <tt>-meabi</tt> option is on by default
if you configured GCC using one of the <tt>powerpc*-*-eabi*</tt> options.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-msdata=eabi</font></tt></div>

<ul><font size=+1>On System V.4 and embedded PowerPC systems, put small
initialized const global and static data in the <tt>.sdata2</tt> section,
which is pointed to by register <tt>r2</tt> . Put small initialized non-const
global and static data in the <tt>.sdata</tt> section, which is pointed
to by register <tt>r13</tt> . Put small uninitialized global and static
data in the <tt>.sbss</tt> section, which is adjacent to the <tt>.sdata</tt>
section. The <tt>-msdata=eabi</tt> option is incompatible with the <tt>-mrelocatable</tt>
option. The <tt>-msdata=eabi</tt> option also sets the <tt>-memb</tt> option.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-msdata=sysv</font></tt></div>

<ul><font size=+1>On System V.4 and embedded PowerPC systems, put small
global and static data in the <tt>.sdata</tt> section, which is pointed
to by register <tt>r13</tt> . Put small uninitialized global and static
data in the <tt>.sbss</tt> section, which is adjacent to the <tt>.sdata</tt>
section.</font>
<p><font size=+1>The <tt>-msdata=sysv</tt> option is incompatible with
the <tt>-mrelocatable</tt> option.</font>
<br>&nbsp;</ul>

<div CLASS="BodyHang1"><tt><font size=+1>-msdata=default</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-msdata</font></tt></div>

<ul><font size=+1>On System V.4 and embedded PowerPC systems, if <tt>-meabi</tt>
is used, compile code the same as <tt>-msdata=eabi</tt>, otherwise compile
code the same as <tt>-msdata=sysv</tt> .</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-msdata-data</font></tt></div>

<ul><font size=+1>On System V.4 and embedded PowerPC systems, put small
global and static data in the <tt>.sdata</tt> section. Put small uninitialized
global and static data in the <tt>.sbss</tt> section. Do not use register
<tt>r13</tt>
to address small data however.</font></ul>

<ul>
<div CLASS="BodyListFollow"><font size=+1>This is the default behavior
unless other <tt>-msdata</tt> options are used.</font></div>
</ul>

<div CLASS="BodyHang1"><tt><font size=+1>-msdata=none</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mno-sdata</font></tt></div>

<ul><font size=+1>On embedded PowerPC systems, put all initialized global
and static data in the <tt>.data</tt> section, and all uninitialized data
in the <tt>.bss</tt> section.</font></ul>
<font size=+1><tt>-G</tt> <i><tt>num</tt></i></font>
<ul><font size=+1>On embedded PowerPC systems, put global and static items
less than or equal to <i><tt>num</tt></i> bytes into the small data or
bss sections instead of the normal data or bss section. By default, num
is 8. The ` <tt>-G</tt> num switch is also passed to the linker. All modules
should be compiled with the same <tt>-G</tt> <i><tt>num</tt></i> value.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mregnames</font></tt></div>

<div CLASS="BodyHang1List"><tt><font size=+1>-mno-regnames</font></tt></div>

<ul><font size=+1>On System V.4 and embedded PowerPC systems, do (do not)
emit register names in the assembly language output using symbolic forms.</font></ul>
</ul>

<div CLASS="Heading2"><a NAME="PPC_floating-point_subroutines"></a><b><i><font face="Times New Roman,Times"><font size=+2>Floating-point
subroutines for PowerPC</font></font></i></b></div>
<font size=+1>The following two kinds of floating point subroutines are
useful with the GNU compiler.</font>
<ul>
<ul>
<ul>
<li CLASS="Bullet">
<font size=+1>Software implementations of the basic functions (floating-point
multiply, divide, add, subtract), for use when there is no hardware floating-point
support.</font></li>

<li CLASS="Bullet">
<font size=+1>General-purpose mathematical subroutines, included with implementation
of the standard C mathematical subroutine library. See <a href="../4_libs/b_GNUPro_Math_Library/libmMathematical_Functions_mathh.html">Mathematical
functions (<tt>math.h</tt>)</a> in <i><a href="../4_libs/b_GNUPro_Math_Library/libm.html">GNUPro
Math Library</a></i> in <b><i>GNUPro Libraries</i></b>.</font></li>
</ul>
</ul>
</ul>

<div CLASS="Heading2"><a NAME="Preprocessor_macros"></a><b><i><font face="Times New Roman,Times"><font size=+2>Preprocessor
macro for PowerPC targets</font></font></i></b></div>
<font size=+1>GCC defines the preprocessor macro, <tt>__powerpc-eabi__</tt>,
for the PowerPC configurations.</font>

<p CLASS="Heading1"><a NAME="PPC_assembler_options"></a><b><i><font face="Times New Roman,Times"><font size=+2>Assembler
options for PowerPC targets</font></font></i></b>
<div CLASS="Body"><font size=+1>To use the GNU assembler to assemble GCC
output, configure GCC with the <tt>--with-gnu-as</tt> switch or with the
<tt>-mgas</tt>
option.</font></div>

<ul>
<div CLASS="BodyHang1"><tt><font size=+1>-mgas</font></tt></div>

<ul><font size=+1>Compile using the GNU assembler, <tt>gas</tt>, to assemble
GCC output.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-Wa</font></tt></div>

<ul><font size=+1>If you invoke the GNU assembler through the GNU C compiler
(version 2), you can use the <tt>-Wa</tt> option to pass arguments through
to the assembler. One common use of this option is to exploit the assembler
s listing features.</font></ul>

<ul>
<div CLASS="BodyListFollow"><font size=+1>Assembler arguments that you
specify with GCC,<tt> -Wa</tt> must be separated from each other (and the
<tt>-Wa</tt>)
by commas, like the options, <tt>-alh</tt> and <tt>-L</tt>, in the following
example input, separate from <tt>-Wa</tt>.</font></div>
</ul>
</ul>

<ul>
<ul>
<ul>
<pre CLASS="CodeExample"><font size=+1>powerpc-eabi-gcc -c -g -O -Wa,-alh, -L file.c</font></pre>
</ul>
</ul>
</ul>

<ul>
<div CLASS="BodyHang1"><tt><font size=+1>-L</font></tt></div>

<ul><font size=+1>The additional assembler option, <tt>-L</tt>, preserves
local labels, which may make the listing output more intelligible to humans.</font>
<div CLASS="BodyListFollow"><font size=+1>For example, in the following
commandline, the assembler option,<tt> -ahl</tt>, requests a listing with
interspersed high-level language and assembly language.</font></div>
</ul>

<ul>
<ul>
<pre CLASS="CodeExample"><font size=+1>powerpc-eabi-gcc -c -g -O -Wa,-alh,-L file.c</font></pre>
</ul>
</ul>

<ul>
<div CLASS="BodyListFollow"><font size=+1><tt>-L</tt> preserves local labels,
while the compiler debugging option, <tt>-g</tt>, gives the assembler the
necessary debugging information.</font></div>

<div CLASS="Body"><font size=+1>Use the following options to enable listing
output from the assembler. The letters after <tt>-a</tt> may be combined
into one option, such as <tt>-al</tt> .</font></div>
</ul>

<div CLASS="BodyHang1"><tt><font size=+1>-a</font></tt></div>

<ul><font size=+1>By itself, -a requests listings of high-level language
source, assembly language, and symbols.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-ah</font></tt></div>

<ul><font size=+1>Requests a high-level language listing.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-al</font></tt></div>

<ul><font size=+1>Request an output-program assembly listing.</font></ul>

<div CLASS="BodyHang1">&nbsp;
<p><tt><font size=+1>-as</font></tt></div>

<ul><font size=+1>Requests a symbol table listing.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-ad</font></tt></div>

<ul><font size=+1>Omits debugging directives from listing. High-level listings
require a compiler debugging option like <tt>-g</tt>, and assembly listings
(such as <tt>-al</tt>) requested.</font></ul>
</ul>

<div CLASS="Body"><font size=+1>Use the following listing-control assembler
directives to control the appearance of the listing output (if you do not
request listing output with one of the <tt>-a</tt> options, the following
listing-control directives have no effect).</font></div>

<ul>
<div CLASS="BodyHang1"><tt><font size=+1>.list</font></tt></div>

<ul><font size=+1>Turn on listings for further input.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>.nolist</font></tt></div>

<ul><font size=+1>Turn off listings for further input.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>.psize <i>linecount</i>, <i>columnwidth</i></font></tt></div>

<ul><font size=+1>Describe the page size for your output (the default is
<tt>60,
200</tt>). <tt>gas</tt> generates form feeds after printing each group
of <i><tt>linecount</tt></i> lines. To avoid these automatic form feeds,
specify <tt>0</tt> as <i><tt>linecount</tt></i>. The variable input for
<i><tt>columnwidth</tt></i>
uses the same descriptive option.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>.eject</font></tt></div>

<ul><font size=+1>Skip to a new page (issue a form feed).</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>.title</font></tt></div>

<ul><font size=+1>Use as the title (this is the second line of the listing
output, directly after the source file name and page number) when generating
assembly listings.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>.sbttl</font></tt></div>

<ul><font size=+1>Use as the subtitle (this is the third line of the listing
output, directly after the title line) when generating assembly listings.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-an</font></tt></div>

<ul><font size=+1>Turn off all forms processing.</font></ul>
</ul>

<div CLASS="Heading1"><a NAME="PPC_debugging"></a><b><i><font face="Times New Roman,Times"><font size=+2>Debugging
PowerPC targets</font></font></i></b></div>

<div CLASS="Body"><font size=+1>The PowerPC-configured GNU debugger, GDB,
is called by <tt>powerpc-eabi-gdb</tt>.</font></div>

<div CLASS="Body"><font size=+1>GDB needs to know the following specifications
to talk to PowerPC targets.</font></div>

<ul>
<ul>
<ul>
<li CLASS="Bullet">
<font size=+1>Specifications for what you want to use one, such as <tt>target
remote</tt>, <tt>gdb</tt> s generic debugging protocol.</font></li>

<li CLASS="Bullet">
<font size=+1>Specifications for what serial device connects your PowerPC
board (the first serial device available on your host is the default).</font></li>

<li CLASS="Bullet">
<font size=+1>Specifications for what speed to use over the serial device.</font></li>
</ul>
</ul>
</ul>

<div CLASS="Body"><font size=+1>Use the following GDB commands to specify
the connection to your target board.</font></div>

<ul>
<div CLASS="BodyHang1"><tt><font size=+1>target powerpc <i>serial-device</i></font></tt>
<ul><font size=+1>To run a program on the board, start up GDB with the
name of your program as the argument. To connect to the board, use the
command, <tt>target <i>interface</i> <i>serial-device</i></tt>, where <i><tt>interface</tt></i>
is an interface from the previous list of specifications and <i><tt>serial-device</tt></i>
is the name of the serial port connected to the board. If the program has
not already been downloaded to the board, you may use the <tt>load</tt>
command to download it. You can then use all the usual <tt>gdb</tt> commands.
For example, the following sequence connects to the target board through
a serial port, and loads and runs programs, designated here as <i><tt>prog</tt></i>,
through the debugger.</font></ul>
</div>
</ul>

<center><table CELLSPACING=0 CELLPADDING=0 BGCOLOR="#CCCCCC" >
<tr>
<td>
<pre><b><font size=+1><tt>(gdb)</tt> </font></b><font size=+1><tt>target powerpc com1</tt>&nbsp;</font></pre>
</td>
</tr>

<tr>
<td>
<pre><font size=+1><tt>...</tt>&nbsp;</font></pre>
</td>
</tr>

<tr>
<td>
<pre><font size=+1><tt>breakinst () ../sparc-stub.c:975</tt>&nbsp;</font></pre>
</td>
</tr>

<tr>
<td>
<pre><font size=+1><tt>975&nbsp;&nbsp;&nbsp;&nbsp; }</tt>&nbsp;</font></pre>
</td>
</tr>

<tr>
<td>
<pre><font size=+1><b><tt>(gdb)</tt></b> <tt>s</tt>&nbsp;</font></pre>
</td>
</tr>

<tr>
<td>
<pre><font size=+1><tt>main&nbsp;&nbsp;&nbsp; ()&nbsp;&nbsp; hello.c:50</tt>&nbsp;</font></pre>
</td>
</tr>

<tr>
<td>
<pre><font size=+1><tt>50&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; writer(1,&nbsp;&nbsp;&nbsp; "Got to here\n");</tt>&nbsp;</font></pre>
</td>
</tr>

<tr>
<td>
<pre><font size=+1><b><tt>(gdb)</tt></b>&nbsp;</font></pre>
</td>
</tr>
</table></center>

<ul>
<div CLASS="BodyHang1"><font size=+1><tt>target powerpc</tt> <tt><i>hostname</i>
: <i>portnumber</i></tt></font>
<ul><font size=+1>You can specify a TCP/IP connection instead of a serial
port, using the syntax, <tt><i>hostname</i> : <i>portnumber</i></tt> (assuming
your board, designated here as <i><tt>hostname</tt></i>, is connected,
for instance, to use a serial line, designated by <i><tt>portnumber</tt></i>,
managed by a terminal concentrator).</font>
<p><font size=+1>GDB also supports <tt>set remotedebug</tt> <i><tt>n</tt></i>.
You can see some debugging information about communications with the board
by setting the variable, <tt>remotedebug</tt>.</font></ul>
</div>
</ul>

<div CLASS="Heading2"><a NAME="PPC_stack_frame"></a><b><i><font face="Times New Roman,Times"><font size=+2>The
stack frame</font></font></i></b></div>

<div CLASS="Body"><font size=+1>The following information applies to the
stack frame for the PowerPC.</font></div>

<ul>
<ul>
<ul>
<li CLASS="Bullet">
<font size=+1>The stack grows downwards from high addresses to low addresses.</font></li>

<li CLASS="Bullet">
<font size=+1>A leaf function need not allocate a stack frame if it does
not need one.</font></li>

<li CLASS="Bullet">
<font size=+1>A frame pointer need not be allocated.</font></li>

<li CLASS="Bullet">
<font size=+1>The stack pointer shall always be aligned to 4 byte boundaries.</font></li>

<li CLASS="Bullet">
<font size=+1>The register save area shall be aligned to a 4 byte boundary.</font></li>
</ul>
</ul>
</ul>

<div CLASS="Body"><font size=+1>Stack frames for functions taking a fixed
number of arguments use the definitions in the <a href="#Stack1">following
chart</a>. <font face="Arial,Helvetica">FP</font> points to the same location
as <font face="Arial,Helvetica">SP</font>.</font></div>

<div CLASS="Body">
<center><a NAME="Stack1"></a><map NAME="embPPC-2"></map><img SRC="embPPC-2.gif" USEMAP="#embPPC-2" height=308 width=360></center>
</div>

<div CLASS="Body"><font size=+1>Stack frames for functions that take a
variable number of arguments use the <a href="#Stack_vars">following definitions</a>.</font></div>

<center>
<p><br><a NAME="Stack_vars"></a><map NAME="embPPC-3"></map><img SRC="embPPC-3.gif" USEMAP="#embPPC-3" height=370 width=360></center>

<p><br>
<div CLASS="Heading2"><a NAME="PPC_stack_argument"></a><b><i><font face="Times New Roman,Times"><font size=+2>Argument
passing</font></font></i></b></div>

<div CLASS="Body"><font size=+1>The following table shows the <a href="embPowerPC.html#Arg_passing">general
purpose registers, floating point registers, and the stack frame offset</a>.</font></div>
<a NAME="Arg_passing"></a>
<table BORDER >
<tr BGCOLOR="#CCCCCC">
<th>
<div CLASS="CellHeading"><i><font size=+1>General Purpose Registers</font></i></div>
</th>

<th>
<div CLASS="CellHeading"><i><font size=+1>Floating-Point Registers</font></i></div>
</th>

<th>
<div CLASS="CellHeading"><b><i><font size=+1>Stack Frame Offset</font></i></b></div>
</th>
</tr>

<tr>
<td>
<div CLASS="CellBody"><tt><font size=+1>r3: c</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><tt><font size=+1>f1: ff</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><tt><font size=+1>08: ptr to t</font></tt></div>
</td>
</tr>

<tr>
<td>
<div CLASS="CellBody"><tt><font size=+1>r4: d</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><tt><font size=+1>f2: gg</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><tt><font size=+1>0c: (padding)</font></tt></div>
</td>
</tr>

<tr>
<td>
<div CLASS="CellBody"><tt><font size=+1>r5: e</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><tt><font size=+1>f3: hh</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><tt><font size=+1>10: nn(lo)</font></tt></div>
</td>
</tr>

<tr>
<td>
<div CLASS="CellBody"><tt><font size=+1>r6: f</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><tt><font size=+1>f4: ii</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><tt><font size=+1>14: nn(hi)</font></tt></div>
</td>
</tr>

<tr>
<td>
<div CLASS="CellBody"><tt><font size=+1>r7: g</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><tt><font size=+1>f5: jj</font></tt></div>
</td>

<td>
<div CLASS="CellBody">&nbsp;</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CellBody"><tt><font size=+1>r8: h</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><tt><font size=+1>f6: kk</font></tt></div>
</td>

<td>
<div CLASS="CellBody">&nbsp;</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CellBody"><tt><font size=+1>r9: ptr to ld</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><tt><font size=+1>f7: ll</font></tt></div>
</td>

<td>
<div CLASS="CellBody">&nbsp;</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CellBody"><tt><font size=+1>r10: ptr to s</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><tt><font size=+1>f8: mm</font></tt></div>
</td>

<td>
<div CLASS="CellBody">&nbsp;</div>
</td>
</tr>
</table>

<div CLASS="Heading2"><a NAME="PPC_Function_return_value"></a><b><i><font face="Times New Roman,Times"><font size=+2>Function
return values</font></font></i></b></div>

<div CLASS="Body"><font size=+1>Integers, floating point values, and aggregates
of 8 bytes or less are returned in register <tt>r0</tt> (and <tt>r1</tt>
if necessary).</font></div>

<div CLASS="Body"><font size=+1>Aggregates larger than 8 bytes are returned
by having the caller pass the address of a buffer to hold the value in
<tt>r0</tt>
as an <i>invisible</i> first argument. All arguments are then shifted down
by one. The address of this buffer is returned in <tt>r0</tt> .</font></div>

<div CLASS="Body">
<center>
<hr SIZE=3 WIDTH="100%"><a href="#Top">Top</a>|<a href="emb.html">Contents</a>|<a href="embindex.html">Index</a>|<a href="embV850.html">Previous</a>|<a href="embSPARC_targets.html">Next</a></center>
</div>

</body>
</html>
