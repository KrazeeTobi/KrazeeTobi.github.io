<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.51 [en] (Win95; I) [Netscape]">
   <title>The linker script</title>
</head>
<body>
<a NAME="Top"></a><a href="emb.html">Contents</a>|<a href="embindex.html">Index</a>|<a href="embcrt0_the_main_startup_file.html">Previous</a>|<a href="embIO_support_code.html">Next</a>
<br><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><a NAME="off_165935"></a><a NAME="f0197f7c"></a><b><font face="Futura Md BT"><font color="#000000"><font size=+3>The
linker script</font></font></font></b>
<br>
<hr SIZE=3 WIDTH="100%">
<br><font face="Times New Roman"><font color="#000000"><font size=+1>In
the following path, find the example linker scripts (hosttype signifies
your host configuration and targettype signifies the embedded configuration
to which you target):</font></font></font>
<br><tt><font color="#000000"><font size=+1></font></font></tt>&nbsp;
<blockquote><tt><font color="#000000"><font size=+1>/usr/cygnus/<i>hosttype</i>/<i>targettype</i>/lib/ldscripts/</font></font></tt></blockquote>
<tt><font color="#000000"><font size=+1></font></font></tt>
<p><br><font color="#000000"><font size=+1><font face="Times New Roman">In
that directory, there will be files with the </font><tt>.x</tt><font face="Times New Roman">,
</font><tt>.xbn</tt><font face="Times New Roman">, </font><tt>.xn</tt><font face="Times New Roman">,
</font><tt>.xr</tt><font face="Times New Roman">, </font><tt>.xs</tt><font face="Times New Roman">,
and </font><tt>.xu</tt><font face="Times New Roman"> extensions.</font></font></font><font face="Times New Roman"><font color="#000000"><font size=+1></font></font></font>
<p><font face="Times New Roman"><font color="#000000"><font size=+1>The
linker script accomplishes the following processes to result.</font></font></font>
<ul TYPE=SQUARE>
<ul TYPE=SQUARE>
<li>
<b><i><font face="Times New Roman"><font size=+1>Sets up the memory map
for the application.</font></font></i></b></li>

<br><font face="Times New Roman"><font size=+1>When your application is
loaded into memory, it allocates some RAM, some disk space for I/O, and
some registers. The linker script makes a memory map of this memory allocation
which is important to embedded systems because, having no OS, you have
the ability then to manage the behavior of the chip.</font></font>
<br><font face="Times New Roman"><font color="#000000"><font size=+1>There
are two ways to ensure the memory map is correct.</font></font></font>
<ul TYPE=SQUARE>
<li>
<font face="Times New Roman"><font size=+1>By having the linker create
the memory map by using the option,</font></font><font face="Courier New"><font size=+0>
-Map</font></font><font face="Times New Roman"><font size=+1>.</font></font></li>

<li>
<font face="Times New Roman"><font size=+1>By, after linking, using the
</font></font><font face="Courier New"><font size=+0>nm</font></font><font face="Times New Roman"><font size=+1>
utility to check critical addresses like </font></font><font face="Courier New"><font size=+0>start</font></font><font face="Times New Roman"><font size=+1>,
</font></font><font face="Courier New"><font size=+0>bss_end</font></font><font face="Times New Roman"><font size=+1>
and </font></font><font face="Courier New"><font size=+0>_etext</font></font><font face="Times New Roman"><font size=+1>.</font></font></li>
</ul>

<li>
<b><font size=+1><i><font face="Times New Roman">For </font></i><tt>g++</tt><i><font face="Times New Roman">,
sets up the constructor and destructor tables.</font></i></font></b></li>
</ul>

<ul TYPE=SQUARE><font face="Times New Roman"><font size=+1>The actual section
names vary depending on your object file format. For </font></font><font face="Courier New"><font size=+0>a.out</font></font><font face="Times New Roman"><font size=+1>
and </font></font><font face="Courier New"><font size=+0>coff</font></font><font face="Times New Roman"><font size=+1>,
the three main sections are </font></font><font face="Courier New"><font size=+0>.text</font></font><font face="Times New Roman"><font size=+1>,</font></font><font face="Courier New"><font size=+0>
.data</font></font><font face="Times New Roman"><font size=+1> and </font></font><font face="Courier New"><font size=+0>.bss</font></font><font face="Times New Roman"><font size=+1>.</font></font>
<br><font face="Times New Roman"><font size=+1>See also <i><font color="#000000"><a href="#GPLUS">Setting
up constructor and destructor tables for G++</a></font></i>.</font></font>
<li>
<b><i><font face="Times New Roman"><font size=+1>Sets the default values
for variables used elsewhere.</font></font></i></b></li>

<br><font face="Times New Roman"><font size=+1>These default variables
are used by </font></font><font face="Courier New"><font size=+0>sbrk()</font></font><font size=+1><font face="Times New Roman">and
the </font><tt>crt0</tt><font face="Times New Roman"> file, typically called
by </font></font><font face="Courier New"><font size=+0>_bss_start</font></font><font face="Times New Roman"><font size=+1>
and </font></font><font face="Courier New"><font size=+0>_end</font></font><font face="Times New Roman"><font size=+1>.</font></font>
<br><font size=+1>See also <font color="#000000"><a href="#Default_values"><i><font face="Times New Roman">Setting
default values for variables, </font></i></a></font></font><font color="#000000"><a href="#Default_values"><font face="Courier New"><font size=+0>_bss_start</font></font><i><font face="Times New Roman"><font size=+1>
and </font></font></i><font face="Courier New"><font size=+0>_end</font></font></a></font><font size=+1>.</font></ul>
</ul>
<font color="#000000"><font size=+1><font face="Times New Roman">For more
explanation of linker scripts, see <a href="../5_ut/b_Usingld/ldLinker_scripts.html">Linker
scripts</a> in <a href="../5_ut/b_Usingld/ld.html"><i>Using</i> </a></font><tt><a href="../5_ut/b_Usingld/ld.html">ld</a></tt><font face="Times New Roman">
in <b><i>GNUPro Utilities</i></b>.</font></font></font>
<p><font face="Times New Roman"><font color="#000000"><font size=+1>The
following is an example of a linker script for an </font></font></font><font face="Courier New"><font size=+0>m68k</font></font><font face="Times New Roman"><font color="#000000"><font size=+1>-based
target board.</font></font></font>
<ul>
<ul>
<ul><font face="Arial"><font size=+1>1.</font></font>
<br><font face="Times New Roman"><font size=+1>Use the </font></font><font face="Courier New"><font size=+0>STARTUP</font></font><font face="Times New Roman"><font size=+1>
command which loads the file so that it executes first.</font></font></ul>
</ul>
</ul>

<ul TYPE=SQUARE>
<ul>
<ul>
<ul>
<ul>
<ul>
<pre><font face="Courier New"><font size=+1>STARTUP(crt0.o)</font></font></pre>
</ul>
</ul>
</ul>
<font face="Times New Roman"><font size=+1>The </font></font><font face="Courier New"><font size=+0>m68k-coff</font></font><font face="Times New Roman"><font size=+1>
configuration default does not link in </font></font><font face="Courier New"><font size=+0>crt0.o</font></font><font face="Times New Roman"><font size=+1>
because it assumes that a developer has crt0. This behavior is controlled
in the </font></font><font face="Courier New"><font size=+0>config</font></font><font face="Times New Roman"><font size=+1>
file for each architecture in a macro called </font></font><font face="Courier New"><font size=+0>STARTFILE_SPEC</font></font><font face="Times New Roman"><font size=+1>.
If </font></font><font face="Courier New"><font size=+0>STARTFILE_SPEC</font></font><font face="Times New Roman"><font size=+1>
is set to NULL, </font></font><font face="Courier New"><font size=+0>gcc
</font></font><font face="Times New Roman"><font size=+1>formats
its command line and doesn’t add </font></font><font face="Courier New"><font size=+0>crt0.o</font></font><font face="Times New Roman"><font size=+1>.
Any filename can be specified with </font></font><font face="Courier New"><font size=+0>STARTUP</font></font><font face="Times New Roman"><font size=+1>
although the default is always </font></font><font face="Courier New"><font size=+0>crt0.o</font></font><font face="Times New Roman"><font size=+1>.</font></font>
<p><font face="Times New Roman"><font size=+1>If you use only </font></font><font face="Courier New"><font size=+0>ld</font></font><font face="Times New Roman"><font size=+1>
to link, you control whether or not to link in </font></font><font face="Courier New"><font size=+0>crt0.o</font></font><font face="Times New Roman"><font size=+1>
on the command line.</font></font>
<p><font face="Times New Roman"><font size=+1>If you have multiple crt0
files, you can leave </font></font><font face="Courier New"><font size=+0>STARTUP</font></font><font face="Times New Roman"><font size=+1>
out, and link in </font></font><font face="Courier New"><font size=+0>crt0.o</font></font><font face="Times New Roman"><font size=+1>
in the makefile or use different linker scripts. Sometimes this option
is used to initialize floating point values or to add device support.</font></font>
<br>&nbsp;
<p><font face="Arial"><font size=+1>2.</font></font>
<br><font face="Times New Roman"><font size=+1>Using </font></font><font face="Courier New"><font size=+0>GROUP</font></font><font face="Times New Roman"><font size=+1>,
load the specified file.</font></font>
<ul>
<ul>
<ul>
<pre><font face="Courier New"><font size=+1>GROUP(-lgcc-liop-lc)</font></font></pre>
</ul>
</ul>
</ul>
<font face="Times New Roman"><font size=+1>In this case, the file is a
relocated library that contains the definitions for the low-level functions
needed by </font></font><font face="Courier New"><font size=+0>libc.a</font></font><font face="Times New Roman"><font size=+1>.
The file to load could have also been specified on the command line, but
as it’s always needed, it might as well be here as a default.</font></font>
<br>&nbsp;
<p><font face="Arial"><font size=+1>3.</font></font>
<br><font face="Courier New"><font size=+0>SEARCH_DIR</font></font><font face="Times New Roman"><font size=+1>
specifies the path in which to look for files.</font></font>
<ul>
<ul>
<ul>
<pre><font face="Courier New"><font size=+1>SEARCH_DIR(.)</font></font></pre>
</ul>
</ul>
</ul>
<font face="Arial"><font size=+1>4.</font></font>
<br><font face="Times New Roman"><font size=+1>Using </font></font><font face="Courier New"><font size=+0>_DYNAMIC</font></font><font face="Times New Roman"><font size=+1>,
specify whether or not there are shared dynamic libraries. In the following
example’s case, there are no shared libraries.</font></font>
<ul>
<ul>
<ul>
<pre><font face="Courier New"><font size=+1>__DYNAMIC = 0;</font></font></pre>
</ul>
</ul>
</ul>
<font face="Arial"><font size=+1>5.</font></font>
<br><font face="Times New Roman"><font size=+1>Set _stack, the variable
for specifying RAM for the ROM monitor.</font></font>
<br>&nbsp;
<p><font face="Arial"><font size=+1>6.</font></font>
<br><font face="Times New Roman"><font size=+1>Specify a name for a section
to which you can refer later in the script. In the following example’s
case, it’s only a pointer to the beginning of free RAM space with an upper
limit at 2M. If the output file exceeds the upper limit, </font></font><font face="Courier New"><font size=+0>MEMORY</font></font><font face="Times New Roman"><font size=+1>
produces an error message. First, in this case, we set up the memory map
of the board’s stack for high memory for both the </font></font><font face="Courier New"><font size=+0>rom68k</font></font><font face="Times New Roman"><font size=+1>
and </font></font><font face="Courier New"><font size=+0>mon68k</font></font><font face="Times New Roman"><font size=+1>
monitors.</font></font>
<br>&nbsp;
<ul TYPE=SQUARE>
<ul TYPE=SQUARE>
<ul TYPE=SQUARE>
<pre><font face="Courier New"><font size=+1>MEMORY&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp; ram&nbsp;&nbsp;&nbsp;&nbsp; :&nbsp;&nbsp;&nbsp;&nbsp; ORIGIN = 0x10000, LENGTH = 2M&nbsp;
}</font></font></pre>
</ul>
</ul>
</ul>

<li>
<a NAME="GPLUS"></a><i><font face="Times New Roman"><font color="#000000"><font size=+1>Setting
up constructor and destructor tables for G++</font></font></font></i></li>
</ul>

<ul><font face="Arial"><font size=+1>1.</font></font>
<br><font face="Times New Roman"><font size=+1>Set up the </font></font><font face="Courier New"><font size=+0>.text</font></font><font face="Times New Roman"><font size=+1>
section, using the following example’s input.</font></font>
<ul>
<ul>
<ul>
<pre><font face="Courier New"><font size=+1>SECTIONS&nbsp;
{&nbsp;
&nbsp;&nbsp; .text :&nbsp;
&nbsp;&nbsp; {&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CREATE_OBJECT_SYMBOLS&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *(.text)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; etext = .;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; __CTOR_LIST__ = .;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LONG((__CTOR_END__ - __CTOR_LIST__) / 4 - 2)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *(.ctors)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LONG(0)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; __CTOR_END__ = .;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; __DTOR_LIST__ = .;&nbsp;

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LONG((__DTOR_END__ - __DTOR_LIST__) / 4 - 2)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *(.dtors)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LONG(0)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; __DTOR_END__ = .;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *(.lit)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *(.shdata) }&nbsp;
&nbsp;&nbsp; > ram&nbsp;
&nbsp;&nbsp; .shbss SIZEOF(.text) + ADDR(.text) : {&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *(.shbss)&nbsp;
&nbsp;&nbsp; }</font></font></pre>
</ul>
</ul>
</ul>
<font face="Times New Roman"><font size=+1>In a </font></font><font face="Courier New"><font size=+0>coff</font></font><font face="Times New Roman"><font size=+1>
file, all the actual instructions reside in </font></font><font face="Courier New"><font size=+0>.text</font></font><font face="Times New Roman"><font size=+1>
for also setting up the constructor and destructor tables for G++. Notice
that the section description redirects itself to the RAM variable that
was set up earlier.</font></font>
<p><font face="Arial"><font size=+1>2.</font></font>
<br><font face="Times New Roman"><font size=+1>Set up the </font></font><font face="Courier New"><font size=+0>.data</font></font><font face="Times New Roman"><font size=+1>
section.</font></font>
<ul>
<ul>
<ul>
<ul>
<pre><font face="Courier New"><font size=+1>&nbsp;&nbsp; .talias : { } > ram&nbsp;
&nbsp;&nbsp; .data : {&nbsp;
&nbsp;&nbsp; *(.data)&nbsp;
&nbsp;&nbsp; CONSTRUCTORS&nbsp;
&nbsp;&nbsp; _edata = .;&nbsp;
} > ram</font></font></pre>
</ul>
</ul>
</ul>
</ul>
<font face="Times New Roman"><font size=+1>In a </font></font><font face="Courier New"><font size=+0>coff</font></font><font face="Times New Roman"><font size=+1>
file, this is where all of the initialized data goes. </font></font><font face="Courier New"><font size=+0>CONSTRUCTORS</font></font><font face="Times New Roman"><font size=+1>
is a special command used by </font></font><font face="Courier New"><font size=+0>ld</font></font><font face="Times New Roman"><font size=+1>.</font></font></ul>
</ul>

<ul TYPE=SQUARE>
<li>
<a NAME="Default_values"></a><font color="#000000"><i><font face="Times New Roman"><font size=+1>Setting
default values for variables, </font></font></i><font face="Courier New"><font size=+0>_bss_start</font></font><i><font face="Times New Roman"><font size=+1>
and </font></font></i><font face="Courier New"><font size=+0>_end</font></font></font></li>

<p><br><font color="#000000"><font face="Times New Roman"><font size=+1>Set
up the </font></font><font face="Courier New"><font size=+0>.bss</font></font><font face="Times New Roman"><font size=+1>
section:</font></font></font>
<ul TYPE=SQUARE>
<ul>
<ul>
<ul>
<pre><font face="Courier New"><font size=+1>&nbsp;&nbsp; .bss SIZEOF(.data) + ADDR(.data) :&nbsp;
&nbsp;&nbsp; {&nbsp;
&nbsp;&nbsp; __bss_start = ALIGN(0x8);&nbsp;
&nbsp;&nbsp; *(.bss)&nbsp;
&nbsp;&nbsp; *(COMMON)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end = ALIGN(0x8);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _end = ALIGN(0x8);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; __end = ALIGN(0x8);&nbsp;
&nbsp;&nbsp; }&nbsp;
&nbsp;&nbsp; .mstack : { } > ram&nbsp;
&nbsp;&nbsp; .rstack : { } > ram&nbsp;
&nbsp;&nbsp; .stab . (NOLOAD) :&nbsp;
&nbsp;&nbsp; {&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [ .stab ]&nbsp;
&nbsp;&nbsp; }&nbsp;
&nbsp;&nbsp; .stabstr . (NOLOAD) :&nbsp;
&nbsp;&nbsp; {&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [ .stabstr ]&nbsp;
&nbsp;&nbsp; }&nbsp;
}</font></font></pre>
</ul>
</ul>
</ul>
</ul>
<font color="#000000"><font face="Times New Roman"><font size=+1>In a </font></font><font face="Courier New"><font size=+0>coff</font></font><font face="Times New Roman"><font size=+1>
file, this is where uninitialized data goes. The default values for </font></font><font face="Courier New"><font size=+0>_bss_start</font></font><font face="Times New Roman"><font size=+1>
and </font></font><font face="Courier New"><font size=+0>_end</font></font><font size=+1><font face="Times New Roman">
are set here for use by the </font><tt>crt0</tt><font face="Times New Roman">
file when it zeros the </font></font><font face="Courier New"><font size=+0>.bss</font></font><font face="Times New Roman"><font size=+1>
section.</font></font></font></ul>
</ul>

<center>
<hr SIZE=3 WIDTH="100%">
<br><a href="#Top">Top</a>|<a href="emb.html">Contents</a>|<a href="embindex.html">Index</a>|<a href="embcrt0_the_main_startup_file.html">Previous</a>|<a href="embIO_support_code.html">Next</a></center>

</body>
</html>
