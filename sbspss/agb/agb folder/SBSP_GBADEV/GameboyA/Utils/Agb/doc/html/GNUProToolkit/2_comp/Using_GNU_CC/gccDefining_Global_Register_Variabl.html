<HTML>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
   <META NAME="GENERATOR" CONTENT="Mozilla/4.04 [en] (Win95; I) [Netscape]">
   <TITLE>Defining Global Register Variables</TITLE>
</HEAD>
<BODY>
<A NAME="Top"></A><A HREF="gcc.html">Contents</A>|<A HREF="gccindex.html">Index</A>|<A HREF="gccVariables_in_Specified_Registers.html">Previous</A>|<A HREF="gccSpecifying_Registers_for_Local_V.html">Next</A>
<BR><FONT FACE="Futura Md BT"><FONT COLOR="#000000">&nbsp;<A NAME="off_4196996"></A><A NAME="2295dcd0"></A><B><FONT SIZE=+3>Defining
global register variables&nbsp;</FONT></B>&nbsp;</FONT></FONT>&nbsp;
<HR SIZE=6 WIDTH="100%">
<BR><FONT FACE="Times New Roman"><FONT SIZE=+1>You can define a global
register variable in GNU C like the following example's declaration shows.</FONT></FONT>
<UL>
<PRE><FONT FACE="Courier New"><FONT SIZE=+1>register int *foo asm ("a5");</FONT></FONT></PRE>
</UL>
<FONT FACE="Times New Roman"><FONT SIZE=+1>Here, </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>a5</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
is the name of the register which should be used. Choose a register which
is normally saved and restored by function calls on your machine, so that
library routines will not clobber it.</FONT></FONT>

<P><FONT FACE="Times New Roman"><FONT SIZE=+1>Naturally the register name
is CPU-dependent, so you would need to conditionalize your program according
to CPU type. The </FONT></FONT><FONT SIZE=+0><FONT FACE="Courier New">a5</FONT>
</FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>register would be a good
choice on a Motorola 68000 for a variable of pointer type. On machines
with register windows, choose a <I>global</I> register that is not affected
magically by the function call mechanism.</FONT></FONT>

<P><FONT FACE="Times New Roman"><FONT SIZE=+1>In addition, operating systems
on one type of CPU may differ in how they name the registers; then you
would need additional conditionals. For example, some Motorola 68000 operating
systems call the register, </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0><B>%</B>a5</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>.</FONT></FONT>

<P><FONT FACE="Times New Roman"><FONT SIZE=+1>Defining such a register
variable does not reserve the register; it remains available for other
uses in place s where flow control determines the variable's value is not
live. However, these registers are made unavailable for use in the reload
pass; excessive use of this feature leaves the compiler too few available
registers to compile certain functions.&nbsp;</FONT></FONT>

<P><FONT FACE="Times New Roman"><FONT SIZE=+1>This option does not guarantee
that GNU CC will generate code that has this variable in the register you
specify at all times. You may not code an explicit reference in an </FONT></FONT><FONT FACE="Courier New,Courier">asm</FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
statement and assume it will always refer to this variable.</FONT></FONT>

<P><FONT FACE="Times New Roman"><FONT SIZE=+1>Stores into local register
variables may be deleted when they appear to be dead according to data
flow analysis. References to local register variables may be deleted or
moved or simplified.</FONT></FONT>

<P><FONT FACE="Times New Roman"><FONT SIZE=+1>It is not safe for one function
that uses a global register variable to call another such function, </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>foo</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>,
by way of a third function, </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>lose</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>,
that was compiled without knowledge of this variable (i.e., in a different
source file in which the variable wasn’t declared). This is because </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>lose</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
might save the register and put some other value there. For example, you
can’t expect a global register variable to be available in the comparison-function
that you pass to </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>qsort</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>,
since </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>qsort</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
might have put something else in that register. (If you are prepared to
recompile </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>qsort</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
with the same global register variable, you can solve this problem.)</FONT></FONT>

<P><FONT FACE="Times New Roman"><FONT SIZE=+1>If you want to recompile
</FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>qsort</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
or other source files which do not actually use your global register variable,
so that they will not use that register for any other purpose, then it
suffices to specify the compiler option,</FONT></FONT>&nbsp; <FONT FACE="Times New Roman"><FONT SIZE=+1>‘</FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>-ffixed-<I>reg</I></FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>.’
You need not actually add a global register declaration to their source
code.</FONT></FONT>

<P><FONT FACE="Times New Roman"><FONT SIZE=+1>A function which can alter
the value of a global register variable cannot safely be called from a
function compiled without this variable, because it could clobber the value
the caller expects to find there on return. Therefore, the function which
is the entry point into the part of the program that uses the global register
variable must explicitly save and restore the value which belongs to its
caller. On most machines, </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>longjmp</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
will restore to each global register variable the value it had at the time
of the </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>setjmp</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>.
On some machines, however, </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>longjmp</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
will not change the value of global register variables.</FONT></FONT>

<P><FONT FACE="Times New Roman"><FONT SIZE=+1>To be portable, the function
that called </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>setjmp</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
should make other arrangements to save the values of the global register
variables, and to restore them in a </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>longjmp</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>.
This way, the same thing will happen regardless of what </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>longjmp</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
does. All global register variable declarations must precede all function
definitions. If such a declaration could appear after function definitions,
the declaration would be too late to prevent the register from being used
for other purposes in the preceding functions. Global register variables
may not have initial values, because an executable file has no means to
supply initial contents for a register. On the SPARC, there are reports
that </FONT></FONT><TT><FONT SIZE=+0>g3</FONT><FONT SIZE=+1> ... </FONT><FONT SIZE=+0>g7</FONT></TT><FONT FACE="Times New Roman"><FONT SIZE=+1>
are suitable registers, but certain library functions, such as </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>getwd</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>,
as well as the subroutines for division and remainder, modify </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>g3</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
and </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>g4</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>.
</FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>g1</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
and </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>g2</FONT></FONT><FONT SIZE=+1><FONT FACE="Times New Roman">
are local temporaries. On the Motorola 68000, </FONT><TT>a2 ... a5</TT><FONT FACE="Times New Roman">
should be suitable, as should </FONT><TT>d2 ... d7</TT><FONT FACE="Times New Roman">.
Of course, it will not do to use more than a few of those.</FONT></FONT>
<CENTER>
<HR SIZE=3 WIDTH="100%"></CENTER>

<CENTER><A HREF="#Top">Top</A>|<A HREF="gcc.html">Contents</A>|<A HREF="gccindex.html">Index</A>|<A HREF="gccVariables_in_Specified_Registers.html">Previous</A>|<A HREF="gccSpecifying_Registers_for_Local_V.html">Next</A></CENTER>

</BODY>
</HTML>
