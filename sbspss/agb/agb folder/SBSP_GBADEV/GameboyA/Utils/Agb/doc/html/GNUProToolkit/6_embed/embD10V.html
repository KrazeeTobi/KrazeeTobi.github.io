<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.51 [en] (Win95; I) [Netscape]">
   <title> Mitsubishi D10V development</title>
</head>
<body bgcolor="#FFFFFF">

<div CLASS="ChapterTitle"><a NAME="Top"></a><a href="emb.html">Contents</a>|<a href="embvrxxxx.html">Previous</a>|<a href="m32r.html#Top">Next</a>
<br><font face="Futura Md BT"><font size=+3>Mitsubishi D10V development</font></font></div>

<div CLASS="BodyAfterHead">
<hr SIZE=3 WIDTH="100%"><font size=+1>The following documentation discusses
the Mitsubishi D10V processor.</font></div>

<ul TYPE=SQUARE>
<ul TYPE=SQUARE>
<ul TYPE=SQUARE>
<li CLASS="Bullet">
<font size=+1><a href="#Compiler_support" CLASS="XRef">Compiler support
for D10V targets</a></font></li>

<li CLASS="Bullet">
<font size=+1><a href="#D10Vpreproc" CLASS="XRef">Preprocessor symbols
for D10V targets</a></font></li>

<li CLASS="Bullet">
<font size=+1><a href="#ABI" CLASS="XRef">ABI summary for D10V targets</a></font></li>

<li CLASS="Bullet">
<font size=+1><a href="#Assembler_support" CLASS="XRef">Assembler support
for D10V targets</a></font></li>

<li CLASS="Bullet">
<font size=+1><a href="#Linker" CLASS="XRef">Linker support for D10V targets</a></font></li>

<li CLASS="Bullet">
<font size=+1><a href="#Debugger" CLASS="XRef">Debugger support for D10V
targets</a></font></li>

<li CLASS="Bullet">
<font size=+1><a href="#Simulator" CLASS="XRef">Standalone simulator for
D10V targets</a></font></li>

<li CLASS="Bullet">
<font size=+1><a href="#Overlays" CLASS="XRef">Overlays support for the
D10V targets</a></font></li>
</ul>
</ul>
</ul>

<div CLASS="Heading1"><a NAME="Compiler_support"></a><b><i><font size=+2>Compiler
support for D10V targets</font></i></b></div>

<div CLASS="Body"><font size=+1>For a list of available generic compiler
options, see
<a href="../2_comp/Using_GNU_CC/gccGNU_CC_Command_Options.html">GNU
CC command options</a> in <i><a href="../2_comp/Using_GNU_CC/gcc.html">Using
GNU CC</a></i> in <b><i>GNUPro Compiler Tools</i></b>. In addition, the
following D10V-specific command-line options are supported.</font></div>

<div CLASS="BodyHang1">
<ul><tt><font size=+1>-mint16</font></tt>
<br><tt><font size=+1>-mint32</font></tt>
<ul><font size=+1>Makes <tt>int</tt> data 16 or 32 bits. The default is
<tt>-mint16</tt>.
GCC chooses the appropriate runtime library based on the <tt>-mint16</tt>
or the <tt>-mint32</tt> switch.</font></ul>
</ul>
</div>

<ul>
<div CLASS="BodyHang1"><tt><font size=+1>-mdouble32</font></tt></div>

<div CLASS="BodyHang1"><tt><font size=+1>-mdouble64</font></tt></div>

<ul>
<div CLASS="BodyHang1"><font size=+1>Makes <tt>double</tt> data 32 or 64
bits. The default is <tt>-mdouble32</tt>. The GCC program chooses the appropriate
runtime library based on the <tt>-mdouble32</tt> or <tt>-mdouble64</tt>
switch.</font></div>
</ul>
</ul>

<ul>
<div CLASS="BodyHang1"><tt><font size=+1>-maddac3</font></tt></div>

<div CLASS="BodyHang1"><tt><font size=+1>-mno-addac3</font></tt></div>

<ul>
<div CLASS="BodyHang1"><font size=+1>Enables (or disables) the use of <tt>addac3</tt>
and <tt>subac3</tt> instructions. The <tt>-maddac3</tt> switch also enables
the <tt>-maccum</tt> instruction.</font></div>
</ul>
</ul>

<ul>
<div CLASS="BodyHang1"><tt><font size=+1>-mno-accum</font></tt></div>

<ul><font size=+1>Enables (or disables) the use the 32-bit accumulators
in compiler-generated code.</font></ul>
<tt><font size=+1>-msmall-insns</font></tt>
<br><tt><font size=+1>-mno-small-insns</font></tt>
<ul><font size=+1>Enables (or disables) replacing 1 long instruction with
2 short instructions, where possible. The default is <tt>-msmall-insns</tt>.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>-mcond-move</font></tt></div>

<div CLASS="BodyHang1"><tt><font size=+1>-mno-cond-move</font></tt></div>

<ul>
<div CLASS="BodyHang1"><font size=+1>Enables (or disables) use of conditional
moves.</font></div>

<div CLASS="BodyHang1"><font size=+1>The default is <tt>-mcond-move</tt>.</font></div>
</ul>
</ul>

<div CLASS="Heading1"><a NAME="D10Vpreproc"></a><b><i><font size=+2>Preprocessor
symbols for D10V targets</font></i></b></div>

<div CLASS="Body"><font size=+1>By default, the compiler defines the preprocessor
symbols,
<tt>_</tt> <tt>_D10V_</tt> <tt>_</tt> and <tt>D10V. </tt>If the
<tt>-ansi</tt>
switch is used with GCC for greater ANSI compatibility, then only <tt>__D10V_</tt>
<tt>_</tt> is defined. If <tt>-mint32</tt> is used, <tt>__INT_</tt> <tt>_</tt>
is defined as 32, and <tt>_</tt> <tt>_INT_MAX__</tt> as 2147483647; otherwise,
<tt>_</tt> <tt>_INT_</tt> <tt>_</tt> is defined as 16, and <tt>_</tt> <tt>_INT_MAX_</tt>
<tt>_</tt> as 32767.</font></div>

<div CLASS="Heading1"><a NAME="ABI"></a><b><i><font size=+2>ABI summary
for D10V targets</font></i></b></div>

<div CLASS="Body"><font size=+1>The following documentation discusses the
<i>Application
Binary Interface</i> for the D10V.</font>
<ul>
<ul>
<ul>
<li>
<font size=+1><a href="#Data_types_alignment">Data types and alignment</a></font></li>

<li>
<font size=+1><a href="#CPU_registers">CPU registers</a></font></li>

<li>
<font size=+1><a href="#Register_usage">Register usage</a></font></li>

<li>
<font size=+1><a href="#Stack_frame">The stack frame</a></font></li>

<li>
<font size=+1><a href="#Arg_passing">Argument passing</a></font></li>

<li>
<font size=+1><a href="#Funct_return_values">Function return values</a></font></li>
</ul>
</ul>
</ul>
</div>

<div CLASS="Heading2"><a NAME="Data_types_alignment"></a><b><i><font size=+2>Data
types and alignment</font></i></b></div>

<div CLASS="Body"><font size=+1>The following table shows the <b><i>data
type sizes</i></b>.</font></div>

<table BORDER >
<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><font size=+1><tt>char</tt> :&nbsp;</font></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1>1 byte&nbsp;</font></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><font size=+1><tt>short</tt> :&nbsp;</font></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1>2 bytes&nbsp;</font></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><font size=+1><tt>int</tt> :&nbsp;</font></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1>2 bytes unless <tt>-mint32</tt>, in
which case 4 bytes&nbsp;</font></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><font size=+1><tt>long</tt> :&nbsp;</font></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1>4 bytes&nbsp;</font></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><font size=+1><tt>long long</tt> :&nbsp;</font></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1>8 bytes&nbsp;</font></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><font size=+1><tt>float</tt> :&nbsp;</font></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1>4 bytes&nbsp;</font></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><font size=+1><tt>double</tt> :&nbsp;</font></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1>4 bytes unless <tt>-mdouble64</tt>,
in which case 8 bytes&nbsp;</font></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><font size=+1><tt>long</tt> <tt>double</tt> :&nbsp;</font></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1>8 bytes&nbsp;</font></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><font size=+1><i>pointer </i>:&nbsp;</font></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1>2 bytes&nbsp;</font></div>
</td>
</tr>
</table>

<div CLASS="Body"><font size=+1>The stack is aligned to a two-byte boundary.
One byte is used for characters (including structure/unions made entirely
of <tt>chars</tt>), and two byte alignment for everything else.</font></div>

<div CLASS="Heading2"><a NAME="CPU_registers"></a><b><i><font size=+2>CPU
registers</font></i></b></div>

<div CLASS="Body"><font size=+1>The first four 16-bit words are passed
in registers, <tt>r0</tt> through <tt>r3</tt>; the remaining words are
passed on the stack (top of stack is the fifth word passed). Arguments
that are at least 32 bits in size always start in an even register, which
means there might be an unused register. If the argument is passed on the
stack, there is no extra padding being done. If an argument would normally
start in a register, but there are not enough registers to pass the entire
argument, it is passed on the stack and remaining registers might be used
to pass subsequent arguments.</font></div>

<div CLASS="Body"><font size=+1>The following table shows the order in
which the compiler allocates registers.</font></div>

<table BORDER >
<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><b><i><font size=+1>Volatile registers</font></i></b></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1><tt>r2</tt> , <tt>r3</tt> , <tt>r4</tt>
, <tt>r5</tt> , <tt>r6</tt> , <tt>r7</tt> , <tt>r12</tt> , <tt>r13</tt></font></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><b><i><font size=+1>Saved registers</font></i></b></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1><tt>r6</tt> , <tt>r7</tt> , <tt>r8</tt>
, <tt>r9</tt> , <tt>r10</tt> , <tt>r11</tt></font></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><b><i><font size=+1>Accumulators</font></i></b></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1><tt>a0</tt> , <tt>a1</tt></font></div>
</td>
</tr>
</table>

<div CLASS="Label">
<ul>
<ul><i><font size=+1>Note:</font></i>
<br><font size=+1>Do not depend on this order. Instead, use the GCC extension,
<tt>asm(
)</tt>, and allow the compiler to schedule registers.</font></ul>
</ul>
</div>

<div CLASS="Body"><a NAME="Register_usage"></a><b><i><font size=+2>Register
usage</font></i></b>
<p><font size=+1>The following table shows the register usage.</font></div>

<table BORDER >
<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><font size=+1><tt>r0</tt> <i>through</i> <tt>r3</tt></font></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1>function arguments/function return&nbsp;</font></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><tt><font size=+1>r4</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1>static chain register, not preserved
across calls&nbsp;</font></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><tt><font size=+1>r5</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1>not preserved across calls&nbsp;</font></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><font size=+1><tt>r6</tt> <i>through</i> <tt>r11</tt></font></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1>preserved across calls&nbsp;</font></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><tt><font size=+1>r12</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1>not preserved across calls&nbsp;</font></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><tt><font size=+1>r13</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1>holds return address, not preserved
across calls&nbsp;</font></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><tt><font size=+1>r14</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1>holds constant 0&nbsp;</font></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><tt><font size=+1>r15</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1>stack pointer, preserved across calls&nbsp;</font></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><font size=+1><tt>a0</tt> <i>through</i> <tt>a1</tt></font></div>
</td>

<td>
<div CLASS="CellBody"><font size=+1>preserved across calls&nbsp;</font></div>
</td>
</tr>
</table>

<div CLASS="Body"><font size=+1>The C compiler does not generate code that
uses the control registers. It does not use the accumulators by default,
unless you use the <tt>-maccum</tt> or <tt>-maddac3</tt> switches.</font></div>

<div CLASS="Heading2"><a NAME="Stack_frame"></a><b><i><font size=+2>The
stack frame</font></i></b></div>

<div CLASS="Heading2"><font size=+1>The following documentation discusses
the stack frame for the D10V.</font></div>

<ul TYPE=SQUARE>
<li CLASS="Bullet">
<font size=+1>The stack grows downwards from high addresses to low addresses.</font></li>

<li CLASS="Bullet">
<font size=+1>A leaf function need not allocate a stack frame if it does
not need one.</font></li>

<li CLASS="Bullet">
<font size=+1>A frame pointer need not be allocated.</font></li>

<li CLASS="Bullet">
<font size=+1>The stack pointer shall always be aligned to 2 byte boundaries.</font></li>
</ul>

<div CLASS="Body"><font size=+1>Stack frames for functions that take a
fixed number of arguments use the definitions shown in the following chart.</font></div>

<div CLASS="Body"><font size=+1>The following chart shows the <a href="#stack_allocations">allocations</a>.
The frame pointer (<font face="Arial,Helvetica">FP</font>) points to the
same location as the stack pointer (<font face="Arial,Helvetica">SP</font>).</font>
<br>
<hr SIZE=3 WIDTH="100%"></div>

<div CLASS="Body"><a NAME="stack_allocations"></a><map NAME="embD10V-2"></map><img SRC="embD10V-2.gif" NOSAVE USEMAP="#embD10V-2" height=308 width=360></div>

<hr SIZE=3 WIDTH="100%">
<div CLASS="Body"><font size=+1>Stack frames for functions taking a variable
number of arguments use the <a href="#Stack_frame_args_def">following definitions</a>.
The frame pointer (<font face="Arial,Helvetica">FP</font>) points to the
same location as the stack pointer (<font face="Arial,Helvetica">SP</font>).&nbsp;</font>
<hr SIZE=3 WIDTH="100%"></div>

<div CLASS="Body"><a NAME="Stack_frame_args_def"></a><map NAME="embD10V-3"></map><img SRC="embD10V-3.gif" NOSAVE USEMAP="#embD10V-3" height=325 width=360>
<hr SIZE=3 WIDTH="100%"></div>

<div CLASS="Heading2"><a NAME="Arg_passing"></a><b><i><font size=+2>Argument
passing</font></i></b></div>

<div CLASS="Body"><font size=+1>Arguments are passed to a function using
first registers and then memory if the argument passing registers are used
up. Items passed in registers that are more than 2 bytes must be passed
starting in an even register, skipping the odd register if the odd register
would have been the next register used. Unused argument registers have
undefined values on entry. Adhere to the following rules.</font></div>

<ul>
<ul>
<ul>
<li CLASS="Bullet">
<font size=+1>The first register values are passed in as <tt>r0</tt> and
the last register is <tt>r3</tt>.</font></li>

<li CLASS="Bullet">
<font size=+1>For arguments that would normally start in a register, if
there are not enough registers used for passing arguments to hold the argument,
the argument will be passed entirely on the stack.</font></li>
</ul>
</ul>
</ul>

<div CLASS="Heading2"><a NAME="Funct_return_values"></a><b><i><font size=+2>Function
return values</font></i></b></div>

<div CLASS="Body"><font size=+1>Two byte integers are returned in register,
<tt>r0</tt>.
Four byte integers and floating values are returned in registers,
<tt>r0</tt>
and <tt>r1</tt>. Eight byte integers and floating point values are returned
in registers, <tt>r0</tt>, <tt>r1</tt>, <tt>r2</tt> and <tt>r3</tt>. By
default, <tt>int</tt> values are 2 bytes, and <tt>double</tt> values are
4 bytes. The standard type, <tt>long</tt>, is 4 bytes, and <tt>long double</tt>
is 8 bytes.</font></div>

<div CLASS="Heading1"><a NAME="Assembler_support"></a><b><i><font size=+2>Assembler
support for D10V targets</font></i></b></div>

<div CLASS="Body"><font size=+1>The following documentation discusses the
GNU assembler supported functionality.</font>
<ul>
<ul>
<ul>
<ul>
<li>
<font size=+1><a href="#Size_modifiers">Size modifiers</a></font></li>

<li>
<font size=+1><a href="#Sub_instructions">Sub-instructions</a></font></li>

<li>
<font size=+1><a href="#Specchars">Special characters</a></font></li>

<li>
<font size=+1><a href="#Register_names">Register names</a></font></li>

<li>
<font size=+1><a href="#Predefined_symbols">Predefined symbols</a></font></li>

<li>
<font size=+1><a href="#Addressing_modes">Addressing modes</a></font></li>

<li>
<font size=+1><a href="#@word_modifier"><tt>@word</tt> modifier</a></font></li>

<li>
<font size=+1><a href="#Floating_point_dirs">Floating point directives</a></font></li>

<li>
<font size=+1><a href="#Opcodes">Opcodes</a></font></li>
</ul>
</ul>
</ul>
</ul>
<font size=+1>For a list of available generic assembler options, see <a href="../5_ut/a_Using_AS/asCommandLine_Options.html">Command-line
options</a> in <a href="../5_ut/a_Using_AS/as.html"><i>Using</i> <tt>as</tt></a>
in <b><i>GNUPro Utilities</i></b>. The D10V version of the assembler has
only one machine dependent option.</font></div>

<div CLASS="BodyHang1">
<ul><font size=+1><tt>-O </tt>(uppercase letter, O)</font>
<ul><font size=+1>The D10V can often execute two sub-instructions in parallel.
With this option, the GNU assembler attempts to optimize its output by
detecting when instructions can be executed in parallel.</font></ul>
</ul>
</div>

<div CLASS="Body"><font size=+1>Syntax is based upon the syntax in Mitsubishi's
<b><i>D10V
Architecture</i></b> documentation.</font></div>

<h4 CLASS="Heading2">
<a NAME="Size_modifiers"></a><i><font size=+2>Size modifiers</font></i></h4>

<div CLASS="Body"><font size=+1>The D10V assembler uses the instruction
names in the <b><i>D10V Architecture</i></b> documentation. However, the
names are sometimes ambiguous. There are instruction names that can assemble
to a <tt>short</tt> or <tt>long</tt> form opcode. The assembler always
picks the smallest form it can. When dealing with a symbol that is not
yet defined when a line is being assembled, it always uses the <tt>long</tt>
form. If you need to force the assembler to use either the <tt>short</tt>
or <tt>long</tt> form of the instruction, you can append either <tt>.s</tt>
(<tt>short</tt>) or <tt>.l</tt> (<tt>long</tt>) to it. For example, if
you are writing an assembly program and you want to do a branch to a symbol
that is defined later in your program, you can use the <tt>bra.s foo </tt>declaration.
Both the object-file dumper disassembler and GDB's disassembler appends
<tt>.s</tt>
or <tt>.l</tt> to instructions that have both <tt>short</tt> and <tt>long</tt>
forms.</font></div>

<h4 CLASS="Heading2">
<a NAME="Sub_instructions"></a><i><font size=+2>Sub-instructions</font></i></h4>

<div CLASS="Body"><font size=+1>The D10V assembler takes a series of instructions
as input, either one-per-line, or in the special two-per-line format, (see
<a href="#Specchars" CLASS="XRef">Special
characters</a>). Some of these instructions will be short-form or sub-instructions.
Sub-instructions can be packed into a single instruction. The assembler
does this automatically but works harder at optimization with the <tt>-O</tt>
option. It also detects when it should not pack instructions. For example,
when a label is defined, the next instruction will never be packaged with
the previous one. Whenever a branch-and-link instruction is called, it
will not be packaged with the next instruction so the return address will
be valid. The assembler automatically inserts Nop instructions when necessary.
If you do not want the assembler to automatically make these decisions,
you can control the packaging and execution type (parallel or sequential)
with the special execution symbols.</font></div>

<h4 CLASS="Heading2">
<a NAME="Specchars"></a><i><font size=+2>Special characters</font></i></h4>

<div CLASS="Body"><font size=+1>The D10V assembler supports the characters,
<tt>;</tt> (semi-colon symbol) and&nbsp; <tt>#</tt> (pound symbol). Both
characters are line comment characters when used in the zero column. The
semi-colon may also be used to start a comment anywhere within a line.</font></div>

<div CLASS="Body"><font size=+1>Sub-instructions may be executed in order,
in reverse-order, or in parallel. Instructions listed in the standard one-per-line
format will be executed sequentially. To specify the executing order, use
the following symbols:</font></div>

<ul>
<div CLASS="BodyHang1"><tt><font size=+1>-></font></tt></div>

<ul><font size=+1>Sequential with instruction on the left first.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>&lt;-</font></tt></div>

<ul><font size=+1>Sequential with instruction on the right first.</font></ul>

<div CLASS="BodyHang1"><tt><font size=+1>||</font></tt></div>

<ul><font size=+1>Parallel.</font></ul>
</ul>
<font size=+1>The D10V syntax allows either one instruction per line, one
instruction per line with the execution symbol, or two instructions per
line; for instance, the following declarations serve as examples:</font>
<ul><tt><font size=+1>abs a1 -> abs r0</font></tt>
<ul><font size=+1>Execute these instructions sequentially. The instruction
on the right goes into the right container and is executed second.</font></ul>
<tt><font size=+1>abs r0 &lt;- abs a1</font></tt>
<ul><font size=+1>Execute these reverse-sequentially. The instruction on
the right goes into the right container, and is executed first.</font></ul>
<tt><font size=+1>ld2w r2,@r8+||mac a0,r0,r7</font></tt>
<ul><font size=+1>These two instructions are executed in parallel.</font></ul>
<tt><font size=+1>ld2w r2,@r8+||</font></tt>
<br><tt><font size=+1>mac a0,r0,r7</font></tt>
<ul><font size=+1>Two-line format. These two instructions are executed
in parallel.</font></ul>
<a NAME="previous"></a><tt><font size=+1>ld2w r2,@r8+</font></tt>
<br><tt><font size=+1>mac a0,r0,r7</font></tt>
<ul><font size=+1>Two-line format. These two instructions are executed
sequentially. The assembler puts them in the proper containers.</font></ul>
<tt><font size=+1>ld2w r2,@r8+ -></font></tt>
<br><tt><font size=+1>mac a0,r0,r7</font></tt>
<ul><font size=+1>Two-line format. These two instructions are executed
sequentially. Same as <a href="#previous">previous instructions</a> but
the second instruction always goes into right container.</font></ul>
</ul>

<div CLASS="Body"><font size=+1>The <tt>$</tt> (dollar sign) has no special
meaning, and may be used in symbol names.</font></div>

<h4 CLASS="Heading2">
<a NAME="Register_names"></a><i><font size=+2>Register names</font></i></h4>

<div CLASS="Body"><font size=+1>You can use the predefined symbols, <tt>r0</tt>
through <tt>r15</tt>, to refer to the D10V registers. You can also use
<tt>sp</tt>
as an alias for <tt>r15</tt>. The accumulators are <tt>a0</tt> and <tt>a1</tt>.
There are special register-pair names that may optionally be used in opcodes
that require even-numbered registers. Register names are not case sensitive.</font></div>

<div CLASS="Body"><font size=+1>The following register pairs are used.</font></div>

<div CLASS="CodeExample">
<ul>
<ul><tt><font size=+1>r0-r1</font></tt>
<br><tt><font size=+1>r2-r3</font></tt>
<br><tt><font size=+1>r4-r5</font></tt>
<br><tt><font size=+1>r6-r7</font></tt>
<br><tt><font size=+1>r8-r9</font></tt>
<br><tt><font size=+1>r10-r11</font></tt>
<br><tt><font size=+1>r12-r13</font></tt>
<br><tt><font size=+1>r14-r15</font></tt></ul>
</ul>
</div>

<div CLASS="Body"><font size=+1><tt>st2wr2-r3, @r4</tt> is a sample register
pair instruction.</font></div>

<div CLASS="Body"><a NAME="Predefined_symbols"></a><b><i><font size=+2>Predefined
symbols</font></i></b></div>

<div CLASS="Body"><font size=+1>D10V also has <a href="#predefined_symbol_table">predefined
symbols</a> for the following control registers and status bits. These
predefined symbols are not recognized by the debugger or the disassembler.</font></div>

<br>&nbsp;
<table BORDER >
<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><tt><font size=+1>psw</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><i><font size=+1>Processor Status Word</font></i></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><tt><font size=+1>bpsw</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><i><font size=+1>Backup Processor Status Word</font></i></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><tt><font size=+1>pc</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><i><font size=+1>Program Counter</font></i></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><tt><font size=+1>bpc</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><i><font size=+1>Backup Program Counter</font></i></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><tt><font size=+1>rpt_c</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><i><font size=+1>Repeat Count</font></i></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><tt><font size=+1>rpt_s</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><i><font size=+1>Repeat Start address</font></i></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><tt><font size=+1>rpt_e</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><i><font size=+1>Repeat End address</font></i></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><tt><font size=+1>mod_s</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><i><font size=+1>Modulo Start address</font></i></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><tt><font size=+1>mod_e</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><i><font size=+1>Modulo End address</font></i></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><tt><font size=+1>iba</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><i><font size=+1>Instruction Break Address</font></i></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><tt><font size=+1>f0</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><i><font size=+1>Flag 0</font></i></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><tt><font size=+1>f1</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><i><font size=+1>Flag 1</font></i></div>
</td>
</tr>

<tr VALIGN=TOP>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><tt><font size=+1>c</font></tt></div>
</td>

<td VALIGN=TOP>
<div CLASS="CellBody"><i><font size=+1>Carry flag</font></i></div>
</td>
</tr>

<tr>
<td ALIGN=RIGHT>
<div CLASS="CellBody"><tt><font size=+1>cr0-cr15</font></tt></div>
</td>

<td>
<div CLASS="CellBody"><i><font size=+1>Accepted as synonyms for these control
registers</font></i></div>
</td>
</tr>
</table>
<a NAME="predefined_symbol_table"></a>
<h4 CLASS="Heading2">
<a NAME="Addressing_modes"></a><i><font size=+2>Addressing modes</font></i></h4>

<div CLASS="Body"><font size=+1>The assembler understands the following
addressing modes for the D10V.</font></div>
<font size=+1>The symbol, <tt>R<i>n</i></tt>, in the following examples
refers to any of the specifically numbered registers or register pairs,
but not the control registers.</font>
<ul>
<ul>
<ul>
<li CLASS="BodyHang1">
<tt><font size=+1>R<i>n</i></font></tt></li>

<br><font size=+1>Register direct</font></ul>

<ul>
<li CLASS="BodyHang1">
<tt><font size=+1>@R<i>n</i></font></tt></li>

<br><font size=+1>Register indirect</font></ul>

<ul>
<li CLASS="BodyHang1">
<tt><font size=+1>@R<i>n</i> +</font></tt></li>

<br><font size=+1>Register indirect with post-increment</font></ul>

<ul>
<li CLASS="BodyHang1">
<tt><font size=+1>@R<i>n</i> -</font></tt></li>

<br><font size=+1>Register indirect with post-decrement</font></ul>

<ul>
<li CLASS="BodyHang1">
<tt><font size=+1>@-SP</font></tt></li>

<br><font size=+1>Register indirect with pre-decrement</font></ul>

<ul>
<li CLASS="BodyHang1">
<tt><font size=+1>@(disp, R<i>n</i> )</font></tt></li>

<br><font size=+1>Register indirect with displacement</font></ul>

<ul>
<li CLASS="BodyHang1">
<i><tt><font size=+1>addr</font></tt></i></li>

<br><font size=+1>PC relative address (for branch or rep)</font></ul>

<ul>
<li CLASS="BodyHang1">
<tt><font size=+1>#imm</font></tt></li>

<br><font size=+1>Immediate data (<tt>#</tt> is optional and ignored)</font></ul>
</ul>
</ul>

<div CLASS="Heading2"><a NAME="@word_modifier"></a><font size=+2><tt>@word</tt><b><i>modifier</i></b></font></div>

<div CLASS="Body"><font size=+1>Any symbol followed by <tt>@word</tt> will
be replaced by the symbol's value shifted right by 2. This is used in situations
such as loading a register with the address of a function (or any other
code fragment). For example, if you want to load a register with the location
of the function, <tt>main</tt>, and then jump to that location, use the
following code.</font></div>

<div CLASS="CodeExample">
<ul><tt><font size=+1>ldir2,main@word</font></tt>
<br><tt><font size=+1>jmpr2</font></tt></ul>
</div>

<div CLASS="Heading2"><a NAME="Floating_point_dirs"></a><b><i><font size=+2>Floating
point directives</font></i></b></div>

<div CLASS="Body"><font size=+1>Although the D10V has no hardware floating
point, the
<tt>.float</tt> and <tt>.double</tt> directives generate IEEE
floating-point numbers for compatibility with other development tools.</font></div>

<div CLASS="Heading2"><a NAME="Opcodes"></a><b><i><font size=+2>Opcodes</font></i></b></div>

<div CLASS="Body"><font size=+1>The assembler implements all the standard
D10V opcodes. For the only changes, see <a href="#Size_modifiers" CLASS="XRef">Size
modifiers</a>.</font></div>

<div CLASS="Heading1"><a NAME="Linker"></a><b><i><font size=+2>Linker support
for D10V targets</font></i></b></div>

<div CLASS="Body"><font size=+1>For a list of available generic linker
options, see <a href="../5_ut/b_Usingld/ldLinker_scripts.html">Linker scripts</a>
in <a href="../5_ut/b_Usingld/ld.html"><i>Using</i> <tt>ld</tt></a> in
<b><i>GNUPro
Utilities</i></b>.</font>
<p><font size=+1>There are no D10V specific linker command line options.
See also <a href="#Linker_script_D10V">Linker script</a>.</font></div>

<div CLASS="Heading2"><a NAME="Linker_script_D10V"></a><b><i><font size=+2>Linker
script</font></i></b></div>

<div CLASS="Body"><a NAME="pgfId=465355"></a><font size=+1>The GNU linker
uses a linker script to determine how to process each section in an object
file, and how to lay out the executable. The linker script is a declarative
program consisting of a number of directives. For instance, the directive,
<tt>ENTRY()</tt>,
specifies which symbol in the executable will be designated the executable's
entry point. Since linker scripts can be complicated to write, the linker
includes one built-in script that defines the default linking process.</font>
<p><font size=+1>For the D10V tools, the following <a href="#linker_script_example">linker
script</a> is the default. Although this script is somewhat lengthy, it
is a generic script that will support all ELF situations. In practice,
sections like <tt>.rela.dtors</tt> are unlikely to be generated when compiling
using embedded ELF tools.</font>
<br>
<hr SIZE=3 WIDTH="100%"></div>

<ul>
<ul>
<pre CLASS="CodeExample"><a NAME="linker_script_example"></a><tt><font size=+1>OUTPUT_FORMAT("elf32-d10v", "elf32-d10v", "elf32-d10v")</font></tt></pre>

<pre><tt><font size=+1>OUTPUT_ARCH(d10v)</font></tt></pre>

<pre><tt><font size=+1>ENTRY(_start)</font></tt></pre>

<pre><tt><font size=+1>SEARCH_DIR( &lt;installation directory path> );</font></tt></pre>

<pre><tt><font size=+1>SECTIONS</font></tt></pre>

<pre><tt><font size=+1>{</font></tt></pre>

<pre><tt><font size=+1>/* Read-only sections, merged into text segment: */</font></tt></pre>

<pre><tt><font size=+1>. = 0x2000004;</font></tt></pre>

<pre><tt><font size=+1>.interp : { *(.interp) }</font></tt></pre>

<pre><tt><font size=+1>.hash : { *(.hash) }</font></tt></pre>

<pre><tt><font size=+1>.dynsym : { *(.dynsym) }</font></tt></pre>

<pre><tt><font size=+1>.dynstr : { *(.dynstr) }</font></tt></pre>

<pre><tt><font size=+1>.rel.text : { *(.rel.text) }</font></tt></pre>

<pre><tt><font size=+1>.rela.text : { *(.rela.text) }</font></tt></pre>

<pre><tt><font size=+1>.rel.data : { *(.rel.data) }</font></tt></pre>

<pre><tt><font size=+1>.rela.data : { *(.rela.data) }</font></tt></pre>

<pre><tt><font size=+1>.rel.rodata : { *(.rel.rodata) }</font></tt></pre>

<pre><tt><font size=+1>.rela.rodata : { *(.rela.rodata) }</font></tt></pre>

<pre><tt><font size=+1>.rel.got : { *(.rel.got) }</font></tt></pre>

<pre><tt><font size=+1>.rela.got : { *(.rela.got) }</font></tt></pre>

<pre><tt><font size=+1>.rel.ctors : { *(.rel.ctors) }</font></tt></pre>

<pre><tt><font size=+1>.rela.ctors : { *(.rela.ctors) }</font></tt></pre>

<pre><tt><font size=+1>.rel.dtors : { *(.rel.dtors) }</font></tt></pre>

<pre><tt><font size=+1>.rela.dtors : { *(.rela.dtors) }</font></tt></pre>

<pre><tt><font size=+1>.rel.init : { *(.rel.init) }</font></tt></pre>

<pre><tt><font size=+1>.rela.init : { *(.rela.init) }</font></tt></pre>

<pre><tt><font size=+1>.rel.fini : { *(.rel.fini) }</font></tt></pre>

<pre><tt><font size=+1>.rela.fini : { *(.rela.fini) }</font></tt></pre>

<pre><tt><font size=+1>.rel.bss : { *(.rel.bss) }</font></tt></pre>

<pre><tt><font size=+1>.rela.bss : { *(.rela.bss) }</font></tt></pre>

<pre><tt><font size=+1>.rel.plt : { *(.rel.plt) }</font></tt></pre>

<pre><tt><font size=+1>.rela.plt : { *(.rela.plt) }</font></tt></pre>

<pre><tt><font size=+1>.plt : { *(.plt) }</font></tt></pre>

<pre><tt><font size=+1>.rodata : { *(.rodata) *(.gnu.linkonce.r*) }</font></tt></pre>

<pre><tt><font size=+1>.rodata1 : { *(.rodata1) }</font></tt></pre>

<pre><tt><font size=+1>/* Adjust the address for the data segment. */</font></tt></pre>

<pre><tt><font size=+1>. = ALIGN(4);</font></tt></pre>

<pre><tt><font size=+1>.data : { *(.data) *(.gnu.linkonce.d*)</font></tt></pre>

<pre><tt><font size=+1>CONSTRUCTORS</font></tt></pre>

<pre><tt><font size=+1>}</font></tt></pre>

<pre><tt><font size=+1>.data1 : { *(.data1) }</font></tt></pre>

<pre><tt><font size=+1>.ctors : { *(.ctors) }</font></tt></pre>

<pre><tt><font size=+1>.dtors : { *(.dtors) }</font></tt></pre>

<pre><tt><font size=+1>.got : { *(.got.plt) *(.got) }</font></tt></pre>

<pre><tt><font size=+1>.dynamic : { *(.dynamic) }</font></tt></pre>

<pre><tt><font size=+1>/* We want the small data sections together, so single-instruction offsets can access them all, and initialized data all before uninitialized, so we can shorten the on-disk segment size. */</font></tt></pre>

<pre><tt><font size=+1>.sdata : { *(.sdata) }</font></tt></pre>

<pre><tt><font size=+1>_edata = .;</font></tt></pre>

<pre><tt><font size=+1>PROVIDE (edata = .);</font></tt></pre>

<pre><tt><font size=+1>__bss_start = .;</font></tt></pre>

<pre><tt><font size=+1>.sbss : { *(.sbss) *(.scommon) }</font></tt></pre>

<pre><tt><font size=+1>.bss : { *(.dynbss) *(.bss)</font></tt></pre>

<pre><tt><font size=+1>*(COMMON)</font></tt></pre>

<pre><tt><font size=+1>}</font></tt></pre>

<pre><tt><font size=+1>_end = . ;</font></tt></pre>

<pre><tt><font size=+1>PROVIDE (end = .);</font></tt></pre>

<pre><tt><font size=+1>/* Stabs debugging sections. */</font></tt></pre>

<pre><tt><font size=+1>.stab 0 : { *(.stab) }</font></tt></pre>

<pre><tt><font size=+1>.stabstr 0 : { *(.stabstr) }</font></tt></pre>

<pre><tt><font size=+1>.stab.excl 0 : { *(.stab.excl) }</font></tt></pre>

<pre><tt><font size=+1>.stab.exclstr 0 : { *(.stab.exclstr) }</font></tt></pre>

<pre><tt><font size=+1>.stab.index 0 : { *(.stab.index) }</font></tt></pre>

<pre><tt><font size=+1>.stab.indexstr 0 : { *(.stab.indexstr) }</font></tt></pre>

<pre><tt><font size=+1>.comment 0 : { *(.comment) }</font></tt></pre>

<pre><tt><font size=+1>/* DWARF debug sections. Symbols in the .debug DWARF section are relative to the beginning of the section so we begin .debug at 0. It's not clear yet what needs to happen for the others. */</font></tt></pre>

<pre><tt><font size=+1>.debug 0 : { *(.debug) }</font></tt></pre>

<pre><tt><font size=+1>.debug_info 0 : { *(.debug_info) }</font></tt></pre>

<pre><tt><font size=+1>.debug_abbrev 0 : { *(.debug_abbrev) }</font></tt></pre>

<pre><tt><font size=+1>.debug_line 0 : { *(.debug_line) }</font></tt></pre>

<pre><tt><font size=+1>.debug_frame 0 : { *(.debug_frame) }</font></tt></pre>

<pre><tt><font size=+1>.debug_srcinfo 0 : { *(.debug_srcinfo) }</font></tt></pre>

<pre><tt><font size=+1>.debug_aranges 0 : { *(.debug_aranges) }</font></tt></pre>

<pre><tt><font size=+1>.debug_pubnames 0 : { *(.debug_pubnames) }</font></tt></pre>

<pre><tt><font size=+1>.debug_sfnames 0 : { *(.debug_sfnames) }</font></tt></pre>

<pre><tt><font size=+1>.line 0 : { *(.line) }</font></tt></pre>

<pre><tt><font size=+1>/* These must appear regardless of . */</font></tt></pre>

<pre><tt><font size=+1>/* This sets the stack to the top of the simulator memory (i.e. top of 64K data space). */</font></tt></pre>

<pre><tt><font size=+1>.stack 0x2007FFE : { _stack = .; *(.stack) }</font></tt></pre>

<pre><tt><font size=+1>.text 0x1000000 :</font></tt></pre>

<pre><tt><font size=+1>{</font></tt></pre>

<pre><tt><font size=+1>*(.init)</font></tt></pre>

<pre><tt><font size=+1>*(.fini)</font></tt></pre>

<pre><tt><font size=+1>*(.text)</font></tt></pre>

<pre><tt><font size=+1>/* .gnu.warning sections are handled specially by elf32.em. */</font></tt></pre>

<pre><tt><font size=+1>*(.gnu.warning)</font></tt></pre>

<pre><tt><font size=+1>*(.gnu.linkonce.t*)</font></tt></pre>

<pre><tt><font size=+1>} =0</font></tt></pre>

<pre><tt><font size=+1>_etext = .;</font></tt></pre>

<pre><tt><font size=+1>PROVIDE (etext = .);</font></tt></pre>

<pre><tt><font size=+1>}</font></tt></pre>
</ul>
</ul>

<div CLASS="Body">
<hr SIZE=3 WIDTH="100%"></div>

<div CLASS="Heading1"><a NAME="Debugger"></a><b><i><font size=+2>Debugger
support for D10V targets</font></i></b></div>

<div CLASS="Body"><font size=+1>For the available generic debugger options,
see <a href="../3_dbug/b_Debugging_with_GDB/gdb.html">Debugging with GDB</a>
in <b><i>GNUPro Debugging Tools</i></b>. There are no D10V-specific debugger
command line options.</font>
<p><font size=+1>The following documentation discusses the use of the GNU
debugger, GDB, with the D10V targets.</font>
<ul>
<ul>
<ul>
<li>
<font size=+1><a href="#Trace_buffer">Using the trace buffer</a></font></li>

<li>
<font size=+1><a href="#Trace_control_vars">Trace control variables</a></font></li>
</ul>
</ul>
</ul>
<font size=+1>To specify the D10V simulator as the download target for
debugging, use the GDB command,&nbsp; <tt>target sim</tt>, and to specify
the D10V board as the download target, use the GDB command,&nbsp; <tt>target
remote &lt;<i>port name</i>></tt>, where <tt>&lt;<i>port name</i>></tt>&nbsp;
designates the port to which the board is attached.</font></div>

<div CLASS="Body"><font size=+1>On many Unix platforms substitute the <tt>tty</tt>
device name:</font></div>

<ul>
<ul>
<div CLASS="Code-Example"><tt><font size=+1>target remote /dev/ttya</font></tt></div>
</ul>
</ul>

<div CLASS="Body"><font size=+1>On PC platforms substitute the specific
COM port:</font></div>

<ul>
<ul>
<div CLASS="Code-Example"><tt><font size=+1>target remote com3</font></tt></div>
</ul>
</ul>

<div CLASS="Heading2"><a NAME="Trace_buffer"></a><b><i><font size=+2>Using
the trace buffer</font></i></b></div>

<div CLASS="Body"><font size=+1>The following description discusses using
the trace buffer access in GDB. For the D10V, trace data means instruction
tracing only. Tracing only works with the Dboard_D10V board, not with the
simulator.</font></div>

<div CLASS="Body"><font size=+1>To start tracing, use the <tt>trace</tt>
command. While tracing is on, each time the program stops after being single-stepped
or continued, GDB collects the trace buffer that accumulated. This data
consists of a set of addresses and counts which represent the number of
instructions executed linearly. GDB transfers the data from the target
board and keeps it in a buffer managed by GDB. This buffer is called the
<tt>host-side
trace buffer</tt> or just <tt>trace buffer</tt>, if there is no possibility
of confusion with a target's trace buffer.</font></div>

<div CLASS="Body"><font size=+1>A host-side trace buffer consists of a
set of numbered entries, each of which includes an address and a count.
At any time, you may use the <tt>info trace</tt> command to find out how
many entries and what those entries contain. You also see whether tracing
is currently enabled or disabled.</font></div>

<div CLASS="Body"><font size=+1>You may also use <tt>tdisassemble</tt>
to display the instructions that are at the locations recorded in the trace
buffer. By default, the command disassembles the entire trace buffer; if
you supply two arguments, it disassembles only the entries whose numbers
fall between the given bounds. The arguments are the numbers assigned to
entries in the trace buffer, not addresses.</font></div>

<div CLASS="Body"><font size=+1>To end tracing, use the <tt>untrace</tt>
command. While tracing is off, the trace buffer is preserved unchanged
and you may look at it at any time. However, if you re-enable tracing,
GDB will erase the data already in the trace buffer to make space for recording
a new instruction trace.</font></div>


<p CLASS="Body"><font size=+1>The following test program (<tt>trace.c</tt>)
illustrates tracing:</font>
<br>&nbsp;
<ul>
<ul>
<pre CLASS="CodeExample"><font size=+1><i>i</i>nt a, c;</font></pre>

<pre><font size=+1>main()</font></pre>

<pre><font size=+1>{</font></pre>

<pre><font size=+1>int b, d, i;</font></pre>

<pre><font size=+1>a = 3;</font></pre>

<pre><font size=+1>b = 4;</font></pre>

<pre><font size=+1>c = 456 * (a + b);</font></pre>

<pre><font size=+1>b += c;</font></pre>

<pre><font size=+1>for (i = 0; i &lt; 5; ++i)</font></pre>

<pre><font size=+1>{</font></pre>

<pre><font size=+1>a += d;</font></pre>

<pre><font size=+1>d = b * a;</font></pre>

<pre><font size=+1>}</font></pre>

<pre><font size=+1>}</font></pre>
</ul>
</ul>

<div CLASS="Body"><font size=+1>The following transcript shows these commands
in action. This transcript was generated under Unix.</font></div>

<table CELLSPACING=0 CELLPADDING=0 BGCOLOR="#C0C0C0" >
<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>(gdb) </b>target remote /dev/ttyb&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>Remote debugging using /dev/ttyb&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x1000000 in _start ()&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>(gdb)</b> <tt>load</tt>&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>Loading section .data, size 0x190 vma 0x2000004&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>Loading section .text, size 0x1a8 vma 0x1000000&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>Start address 0x1000000&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>Transfer rate: 3296 bits/sec.</b>&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>(gdb)</b> break main&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>Breakpoint 1 at 0x1000048: file trace.c, line 7.</b>&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>(gdb) </b>continue&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>Continuing.&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>Breakpoint 1, main () at trace.c:7&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>7 a = 3;&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>(gdb)</b> trace&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>Tracing is now on.&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>(gdb)</b> step&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>8 b = 4;&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>(gdb) </b>step&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>9 c = 456 * (a + b);&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>(gdb)</b> step&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>10 b += c;&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>(gdb) </b>info trace&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>8 entries in trace buffer:&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0: 1 instruction at 0x1000048&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>1: 1 instruction at 0x100004c</b>&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>2: 1 instruction at 0x1000050&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>3: 1 instruction at 0x1000054&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>4: 1 instruction at 0x1000058&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>5: 1 instruction at 0x100005c&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>6: 1 instruction at 0x1000060&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>7: 1 instruction at 0x1000064&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>Tracing is currently on.&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>(gdb) </b>untrace&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>Tracing is now off.&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>(gdb)</b> tdisassemble&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>Dump of trace from 0 to 8:&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>7 a = 3;&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>0x1000048 &lt;main+8>: ldi.s r2, 0x3 || nop</b>&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x100004c &lt;main+12>: st r2, @(0x196, r0)8 b = 4;&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x1000050 &lt;main+16>: ldi.s r2, 0x4 -> st r2, @r11&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>9 c = 456 * (a + b);&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x1000054 &lt;main+20>: ld r2, @(0x196, r0)&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x1000058 &lt;main+24>: ld r3, @r11 -> add r2, r3&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x100005c &lt;main+28>: ldi.l r3, 0x1c8&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x1000060 &lt;main+32>: nop || mul r2, r3&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x1000064 &lt;main+36>: st r2, @(0x194, r0)</font></b></pre>
</div>

<pre><b><font size=+1>End of trace dump.&nbsp;</font></b></pre>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>(gdb)</font>&nbsp;</b></pre>
</div>
</td>
</tr>
</table>

<div CLASS="Body"><font size=+1>Later we run through the loop, and then
use the arguments, <tt>tdisassemble</tt>, to select portions of the buffer.</font></div>

<table CELLSPACING=0 CELLPADDING=0 BGCOLOR="#C0C0C0" >
<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>(gdb) </b>info trace&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>11 entries in trace buffer:&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0: 8 instructions at 0x1000098&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>1: 3 instructions at 0x1000078&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>2: 12 instructions at 0x1000088</b>&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>3: 3 instructions at 0x1000078&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>4: 12 instructions at 0x1000088&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>5: 3 instructions at 0x1000078&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>6: 12 instructions at 0x1000088&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>7: 3 instructions at 0x1000078&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>8: 12 instructions at 0x1000088&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>9: 4 instructions at 0x1000078&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>10: 1 instruction at 0x10000b8&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>Tracing is currently on.&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>(gdb)</b> tdisassemble 0 3&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>Dump of trace from 0 to 3:&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>14 d = b * a;&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x1000098 &lt;main+88>: ld r2, @r11 || nop&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x100009c &lt;main+92>: ld r3, @(0x196, r0)&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x10000a0 &lt;main+96>: nop || mul r2, r3&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x10000a4 &lt;main+100>: st r2, @(0x2, r11)&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>11 for (i = 0; i &lt; 5; ++i)&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x10000a8 &lt;main+104>: ld r2, @(0x4, r11)&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x10000ac &lt;main+108>: add3 r3, r2, 0x1&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>0x10000b0 &lt;main+112>: st r3, @(0x4, r11)</b>&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x10000b4 &lt;main+116>: bra.s 0x1000078 &lt;main+56> || nop&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x1000078 &lt;main+56>: ld r2, @(0x4, r11)&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x100007c &lt;main+60>: cmpi.s r2, 0x5 || nop&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x1000080 &lt;main+64>: brf0t.l 0x1000088 &lt;main+72>&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>13 a += d;&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x1000088 &lt;main+72>: ld r2, @(0x196, r0)&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x100008c &lt;main+76>: ld r3, @(0x2, r11)&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x1000090 &lt;main+80>: add r2, r3 || nop&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>0x1000094 &lt;main+84>: st r2, @(0x196, r0)</b>&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>14 d = b * a;&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x1000098 &lt;main+88>: ld r2, @r11 || nop&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x100009c &lt;main+92>: ld r3, @(0x196, r0)&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x10000a0 &lt;main+96>: nop || mul r2, r3&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x10000a4 &lt;main+100>: st r2, @(0x2, r11)&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>11 for (i = 0; i &lt; 5; ++i)&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x10000a8 &lt;main+104>: ld r2, @(0x4, r11)&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x10000ac &lt;main+108>: add3 r3, r2, 0x1&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>0x10000b0 &lt;main+112>: st r3, @(0x4, r11)</b>&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x10000b4 &lt;main+116>: bra.s 0x1000078 &lt;main+56> || nop&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>End of trace dump.&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>(gdb)</font></b>&nbsp;</pre>
</div>
</td>
</tr>
</table>

<div CLASS="Body"><a NAME="Trace_control_vars"></a><b><i><font size=+2>Trace
control variables</font></i></b>
<p><font size=+1>There are two GDB trace control variables.</font></div>

<ul TYPE=SQUARE>
<li CLASS="Bullet">
<font size=+1>The variable, <tt>tracedisplay</tt>, controls whether GDB
displays trace data as it is accumulated; by default it does not. The command,
<tt>set
tracedisplay 1</tt>, enables this feature. The data always accumulates,
so it is always possible to use a <tt>tdisassemble</tt> command later to
see the trace data all at once.</font></li>

<li CLASS="Bullet">
<font size=+1>The variable, <tt>tracesource</tt>, controls the display
of source lines corresponding to the trace buffer's addresses; by default,
this is enabled. The command, <tt>set tracesource 0</tt>, will disable,
and <tt>tdisassemble</tt> will display only assembly language.</font></li>
</ul>

<div CLASS="Heading1"><a NAME="Simulator"></a><b><i><font size=+2>Standalone
simulator for D10V targets</font></i></b></div>

<div CLASS="Body"><font size=+1>The simulator supports the Dboard_D10V
<tt>IMAP</tt>
and
<tt>DMAP</tt> registers. The <tt>IMAP0</tt> and <tt>IMAP1</tt> registers
are initialized to <tt>0x1000</tt>, <tt>DMAP</tt> is initialized to <tt>0</tt>
(zero). To change the map registers, write to <tt>0xff00</tt>,
<tt>0xff02</tt>,
or <tt>0xff04</tt>, as specified in the <b><i>D10V Architecture</i></b>
manual in section 9.3.</font></div>

<div CLASS="Body"><font size=+1>The simulator allocates unified memory
from <tt>0x000000</tt> to <tt>0x50ffff</tt> and <tt>0xfe0000</tt> to <tt>0xffffff</tt>.
This corresponds to <tt>IMAP</tt> segment numbers, 0-2 and 127, and <tt>DMAP</tt>
segment numbers, 0-23 and 1015-1023. Any attempts to set the <tt>IMAP</tt>
or <tt>DMAP</tt> registers to unallocated segments will currently result
in simulator errors.</font></div>

<div CLASS="Body"><font size=+1>Two run-time command line options are available
with the simulator (their examples are depicted using the Unix prompt,
<b><tt>%</tt></b>).</font></div>

<ul>
<ul>
<ul>
<li CLASS="Body">
<font size=+1><a href="#t"><tt>-t</tt> command line option</a></font></li>

<li CLASS="Body">
<font size=+1><a href="#v"><tt>-v</tt> command line option</a></font></li>
</ul>
</ul>
</ul>

<div CLASS="Body"><a NAME="t"></a><font size=+1>The <tt>-t</tt> command
line option to the standalone simulator turns on instruction level tracing
as shown in the following segment.</font></div>

<br>&nbsp;
<table CELLSPACING=0 CELLPADDING=0 BGCOLOR="#C0C0C0" >
<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>%</b> <tt>d10v-elf-run -t hello.x</tt>&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x00001d *L: ldi.s r0,0 --- 0x0000 :: 0x0000 F0=0 F1=0 C=0&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x00001d *R: nop&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x00001e B: ldi.s r15,65534 --- 0xfffe :: 0xfffe F0=0 F1=0 C=0&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x00001f B: ldi.s r2,34920 --- 0x8868 :: 0x8868 F0=0 F1=0 C=0&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x000020 B: ldi.s r3,34952 --- 0x8888 :: 0x8888 F0=0 F1=0 C=0&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>0x000021 R: sub r3,r2 0x8888 0x8868 :: 0x002 F0=0 F1=0 C=0</b>&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x000021 L: mv r4,r3 --- 0x0020 :: 0x0020 F0=0 F1=0 C=0&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x000022 L: srli r4,2 0x0020 0x0002 :: 0x0008 F0=0 F1=0 C=0&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x000022 R: mv r1,r0 --- 0x0000 :: 0x0000 F0=0 F1=0 C=0&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>0x000023&nbsp;</font></b></pre>

<pre><b><font size=+1>. . .</font>&nbsp;</b></pre>
</div>
</td>
</tr>
</table>

<div CLASS="Body"><a NAME="v"></a><font size=+1>The <tt>-v</tt> command
line option prints some simple statistics.</font></div>

<table CELLSPACING=0 CELLPADDING=0 BGCOLOR="#C0C0C0" >
<tr>
<td>
<div CLASS="CodeScreen">
<pre><font size=+1><b>%</b> <tt>d10v-elf-run -v hello.x</tt> hello world!&nbsp;</font></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>3 + 4 = 7&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>run hello.x&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>executed 1458 instructions in the left container, 827 parallel, 15 nops&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>executed 1450 instructions in the right container, 827 parallel, 810 nops&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>executed 1344 long instructions&nbsp;</font></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><font size=+1>executed 4252 total instructions</font></b>&nbsp;</pre>
</div>
</td>
</tr>
</table>


<p CLASS="Heading1"><a NAME="Overlays"></a><b><i><font size=+2>Overlays
support for the D10V targets</font></i></b>
<div CLASS="Body"><font size=+1>Overlays are sections of code or data which
are to be loaded as part of a single memory image, but are to be run or
used at a common memory address. At run time, an overlay manager will copy
the sections in and out of the runtime memory address. This approach can
be useful, for example, when a certain region of memory is faster than
another.</font>
<p><font size=+1>The following documentation discusses more of the overlay
support.</font>
<ul>
<ul>
<ul>
<li>
<font size=+1><a href="#Overlay_sample">Sample runtime overlay manager</a></font></li>

<li>
<font size=+1><a href="#Linker_script_for_overlay">Linker script with overlay
functionality</a></font></li>

<li>
<font size=+1><a href="#GDB_overlay_support">GDB overlay support</a></font></li>

<li>
<font size=+1><a href="#Breakpoints">Breakpoints</a></font></li>
</ul>
</ul>
</ul>
</div>

<div CLASS="Heading2"><a NAME="Overlay_sample"></a><b><i><font size=+2>Sample
runtime overlay manager</font></i></b></div>

<div CLASS="Body"><font size=+1>This simple, portable runtime overlay manager
is provided in the <tt>examples</tt> directory. To access the examples
directory, follow the instructions for installing the entire source tree.
The full path uses
<tt>/usr/cygnus/d10v-&lt;<i>yymmdd</i>>/src/examples</tt>,
where <tt>&lt;<i>yymmdd</i>></tt> is replaced with the release date found
on the CD. See <a href="../1_GS/ins01.html">Installation</a> and <b><i><a href="../1_GS/gsintro.html">GETTING
STARTED</a></i></b> for working with GNUPro Toolkit files.</font></div>

<div CLASS="Body"><font size=+1>The sample overlay manager may be used
as is, or as a prototype to develop a 3rd party overlay manager (or adapt
an existing one for use with the GDB debugger). It is intended to be extremely
simple, easy to understand, but not particularly sophisticated. Note that
since the sample overlay manager copies overlay sections four bytes at
a time, it is important that all sections begin on four byte boundaries
at their load addresses as well as their runtime addresses.</font></div>

<div CLASS="Body"><font size=+1>The overlay manager has a single entry
point: a function called <tt>OverlayLoad(ovly_number)</tt>. It looks up
the overlay in a table called <tt>ovly_table</tt> to find the corresponding
section's load address and runtime address; then it copies the section
from its load address into its runtime address. <tt>OverlayLoad</tt> must
be called before code or data in an overlay section can be used by the
program. It is up to the programmer to keep track of which overlays have
been loaded.&nbsp; <tt>_ovly_table
</tt>is built by the linker from information
provided by the programmer in the linker script.</font></div>

<div CLASS="Body"><font size=+1>The example program contains four overlay
sections which are mapped into two runtime regions of memory. Sections,
<tt>.ovly0</tt>
and <tt>.ovly1</tt>, are both mapped into the region starting at <tt>0x1001000</tt>,
and sections, <tt>.ovly2</tt> and <tt>.ovly3</tt>, are both mapped into
the region starting at <tt>0x1002000</tt>.</font></div>

<div CLASS="Heading2"><a NAME="Linker_script_for_overlay"></a><b><i><font size=+2>Linker
script with overlay functionality</font></i></b></div>

<div CLASS="Body"><font size=+1>To build a program with overlays requires
a customized linker script. Our example program is built with the script,
<tt>d10vtext.ld</tt>,
found in the <tt>examples/overlay</tt> directory. This is just a modified
version of the default linker script, with two parts added.</font></div>

<ul>
<pre CLASS="CodeExample"><tt><font size=+1>SECTIONS</font></tt></pre>

<pre><tt><font size=+1>{</font></tt></pre>

<pre><tt><font size=+1>OVERLAY 0x1001000 : AT (0x8000)</font></tt></pre>

<pre><tt><font size=+1>{</font></tt></pre>

<pre><tt><font size=+1>.ovly0 { foo.o(.text) }</font></tt></pre>

<pre><tt><font size=+1>.ovly1 { bar.o(.text) }</font></tt></pre>

<pre><tt><font size=+1>}</font></tt></pre>

<pre><tt><font size=+1>OVERLAY 0x1002000 : AT (0x9000)</font></tt></pre>

<pre><tt><font size=+1>{</font></tt></pre>

<pre><tt><font size=+1>.ovly2 { baz.o(.text) }</font></tt></pre>

<pre><tt><font size=+1>.ovly3 { grbx.o(.text) }</font></tt></pre>

<pre><tt><font size=+1>}</font></tt></pre>

<pre><tt><font size=+1>[...]</font></tt></pre>
</ul>

<div CLASS="Body"><font size=+1>We give the <tt>OVERLAY</tt> command two
arguments. First, the base address where we want all of the overlay sections
to link and run. Second, the address where we want the first overlay section
to load. In the following example, <tt>.ovly1</tt>, will load at <tt>0x8000
+ SIZEOF(.ovly0)</tt>. For a full description of the <tt>OVERLAY</tt> linker
command, see <a href="../5_ut/b_Usingld/ldLinker_scripts.html">Linker scripts</a>
in <a href="../5_ut/b_Usingld/ld.html"><i>Using</i> <tt>ld</tt></a> in
<b><i>GNUPro
Utilities</i></b>. The <tt>OVERLAY</tt> command is really just a syntactic
convenience. If you need finer control over where the individual sections
will be loaded, you can use the syntax in the following code segement.</font></div>

<ul>
<ul>
<pre CLASS="CodeExample"><tt><font size=+1>SECTIONS</font></tt></pre>

<pre><tt><font size=+1>{</font></tt></pre>

<pre><tt><font size=+1>.ovly0 0x1001000 : AT (0x8000) { foo.o(.text) }</font></tt></pre>

<pre><tt><font size=+1>.ovly1 0x1001000 : AT (0x9000) { bar.o(.text) }</font></tt></pre>

<pre><tt><font size=+1>.ovly2 0x1002000 : AT (0xA000) { baz.o(.text) }</font></tt></pre>

<pre><tt><font size=+1>.ovly3 0x1002000 : AT (0xB000) { grbx.o(.text) }</font></tt></pre>

<pre><tt><font size=+1>[...]</font></tt></pre>
</ul>
</ul>

<div CLASS="Body"><font size=+1>The second addition to the linker script
actually builds&nbsp; <tt>_ovly_table</tt>, which will be used by the sample
runtime overlay manager. The following example shows the table having several
entries for each overlay, which must be located somewhere in the <tt>.data</tt>
section.</font></div>

<ul>
<ul>
<pre>&nbsp;<tt><font size=+1>.data :</font></tt></pre>
</ul>
</ul>

<ul>
<ul>
<pre><tt><font size=+1>{</font></tt></pre>

<pre><tt><font size=+1>[...]</font></tt></pre>

<pre><tt><font size=+1>_ovly_table = .;</font></tt></pre>

<pre><tt><font size=+1>LONG(ABSOLUTE(ADDR(.ovly0)));</font></tt></pre>

<pre><tt><font size=+1>LONG(SIZEOF(.ovly0));</font></tt></pre>

<pre><tt><font size=+1>LONG(LOADADDR(.ovly0));</font></tt></pre>

<pre><tt><font size=+1>LONG(0);</font></tt></pre>

<pre><tt><font size=+1>LONG(ABSOLUTE(ADDR(.ovly1)));</font></tt></pre>

<pre><tt><font size=+1>LONG(SIZEOF(.ovly1));</font></tt></pre>

<pre><tt><font size=+1>LONG(LOADADDR(.ovly1));</font></tt></pre>

<pre><tt><font size=+1>LONG(0);</font></tt></pre>

<pre><tt><font size=+1>LONG(ABSOLUTE(ADDR(.ovly2)));</font></tt></pre>

<pre><tt><font size=+1>LONG(SIZEOF(.ovly2));</font></tt></pre>

<pre><tt><font size=+1>LONG(LOADADDR(.ovly2));</font></tt></pre>

<pre><tt><font size=+1>LONG(0);</font></tt></pre>

<pre><tt><font size=+1>LONG(ABSOLUTE(ADDR(.ovly3)));</font></tt></pre>

<pre><tt><font size=+1>LONG(SIZEOF(.ovly3));</font></tt></pre>

<pre><tt><font size=+1>LONG(LOADADDR(.ovly3));</font></tt></pre>

<pre><tt><font size=+1>LONG(0);</font></tt></pre>

<pre><tt><font size=+1>_novlys = .;</font></tt></pre>

<pre><tt><font size=+1>LONG((_novlys - _ovly_table) / 16);</font></tt></pre>

<pre><tt><font size=+1>[...]</font></tt></pre>

<pre><tt><font size=+1>}</font></tt></pre>
</ul>
</ul>

<div CLASS="Body"><font size=+1>Our example program has four functions;
<tt>foo</tt>,
<tt>bar</tt>,
<tt>baz</tt>, and <tt>grbx</tt>. Each is in a separate overlay section.
The functions, <tt>foo</tt> and <tt>bar</tt>, are both linked to run at
address, <tt>0x1001000</tt>, while functions,
<tt>baz</tt> and
<tt>grbx</tt>,
are both linked to run at <tt>0x1002000</tt>.</font></div>

<div CLASS="Body"><font size=+1>The main program calls <tt>OverlayLoad</tt>
once before calling each of the overlaid functions, giving it the overlay
number of the respective overlay. The overlay manager, using <tt>_ovly_table</tt>
that was built up by the linker script, copies each overlaid function into
the appropriate region of memory before it is called.</font></div>

<div CLASS="Body"><font size=+1>In order to compile and link the example
overlay manager, enter the following input at the prompt, <b><tt>%</tt></b>.</font></div>

<ul>
<ul>
<pre CLASS="CodeExample"><tt><font size=+1>d10v-elf-gcc -g -Td10vdata.ld -oovlydata maindata.c ovlymgr.c</font></tt></pre>
</ul>
</ul>

<div CLASS="Body"><font size=+1>Using GDB's built-in overlay support, we
can debug this program even though several of the functions share an address
range. After loading the program, give GDB the <tt>overlay auto </tt>command.
GDB then detects the actions of the overlay manager on the target, and
can step into overlaid functions, show appropriate backtraces, etc. If
a symbol is in an overlay that is not currently mapped, GDB will access
the symbol from its load address instead of the mapped runtime address
(which would currently be holding something else from another overlay).</font></div>

<div CLASS="Body"><font size=+1>In the following example, functions, <tt>foo</tt>
and <tt>bar</tt>, are in different overlays which run at the same address.
We will use GDB's overlay debugging to step into and debug them.</font></div>

<br>&nbsp;
<table CELLSPACING=0 CELLPADDING=0 BGCOLOR="#C0C0C0" >
<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>file ovlydata&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Reading symbols from ovlydata...done.&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb)</b> target sim&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>Connected to the simulator.</b>&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>load&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Loading section .ovly0, size 0x2c lma 0x8000&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Loading section .ovly1, size 0x2c lma 0x9000&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Loading section .ovly2, size 0x2c lma 0xa000&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Loading section .ovly3, size 0x2c lma 0xb000&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Loading section .data00, size 0x4 lma 0xc000&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Loading section .data01, size 0x4 lma 0xd000&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>Loading section .data02, size 0x4 lma 0xe000</b>&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Loading section .data03, size 0x4 lma 0xf000&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Loading section .data, size 0x214 lma 0x2000004&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Loading section .text, size 0x6e0 lma 0x1000000&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Start address 0x1000000&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Transfer rate: 19872 bits in &lt;1 sec.&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb)</b> overlay auto&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>overlay list&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>No sections are mapped.</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>info address foo&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Symbol "foo" is a function at address 0x1001000,&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>-- loaded at 0x8000 in overlay section .ovly0.&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>info symbol 0x1001000&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>foo in unmapped overlay section .ovly0&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>bar in unmapped overlay section .ovly1</b>&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>info address bar&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Symbol "bar" is a function at address 0x1001000,&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>-- loaded at 0x9000 in overlay section .ovly1.&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>break main&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Breakpoint 1 at 0x1000048: file maindata.c, line 18.&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>run&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Starting program: ovlydata&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Breakpoint 1, main () at maindata.c:18&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>18 OverlayLoad(0);&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>next&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>19 OverlayLoad(4);&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb)</b> next&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>20 a = foo(1);&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>overlay list&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Section .ovly0, loaded at 00008000 - 0000802c, mapped at 01001000 - 0100102c&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Section .data00, loaded at 0000c000 - 0000c004, mapped at 02001000 - 02001004&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb)</b> info symbol 0x1001000&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>foo in mapped overlay section .ovly0&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>bar in unmapped overlay section .ovly1&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>
</table>

<div CLASS="Body"><font size=+1>The overlay containing function, <tt>foo</tt>,
is now mapped.</font></div>

<table CELLSPACING=0 CELLPADDING=0 BGCOLOR="#C0C0C0" >
<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>step&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>foo (x=1) at foo.c:6&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>6 if (x)&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>x /i $pc&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x1001008 &lt;foo+8>: ld r2, @r11 -> cmpeqi.s r2, 0x0&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>print foo&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>$1 = {long int (int)} 0x1001000 &lt;foo>&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>print bar&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>$2 = {long int (int)} 0x9000 &lt;*bar*></b>&nbsp;</font></tt></pre>
</div>
</td>
</tr>
</table>

<div CLASS="Body"><font size=+1>GDB uses labels such as <tt>&lt;*bar*></tt>
(with asterisks) to distinguish overlay load addresses from the symbol's
runtime address (where it will be when used by the program).</font></div>

<table CELLSPACING=0 CELLPADDING=0 BGCOLOR="#C0C0C0" >
<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>disassemble&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Dump of assembler code for function foo:&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x1001000 &lt;foo>: st r11, @-sp -> subi sp, 0x2&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>0x1001004 &lt;foo+4>: mv r11, sp -> st r2, @r11</b>&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x1001008 &lt;foo+8>: ld r2, @r11 -> cmpeqi.s r2, 0x0&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x100100c &lt;foo+12>: brf0t.l 0x100101c &lt;foo+28>&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x1001010 &lt;foo+16>: ld2w r2, @(0x1000, r0)&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x1001014 &lt;foo+20>: bra.l 0x1001024 &lt;foo+36>&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x1001018 &lt;foo+24>: bra.l 0x1001024 &lt;foo+36>&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x100101c &lt;foo+28>: ldi.s r2, 0x0 -> ldi.s r3, 0x0&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x1001020 &lt;foo+32>: bra.l 0x1001024 &lt;foo+36>&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x1001024 &lt;foo+36>: add3 sp, r11, 0x2&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x1001028 &lt;foo+40>: ld r11, @sp+ -> jmp r13&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>End of assembler dump.&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>disassemble bar&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Dump of assembler code for function bar:&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x9000 &lt;*bar*>: st r11, @-sp -> subi sp, 0x2&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x9004 &lt;*bar+4*>: mv r11, sp -> st r2, @r11&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x9008 &lt;*bar+8*>: ld r2, @r11 -> cmpeqi.s r2, 0x0&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x900c &lt;*bar+12*>: brf0t.l 0x901c &lt;*bar+28*>&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>0x9010 &lt;*bar+16*>: ld2w r2, @(0x1000, r0)</b>&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x9014 &lt;*bar+20*>: bra.l 0x9024 &lt;*bar+36*>&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x9018 &lt;*bar+24*>: bra.l 0x9024 &lt;*bar+36*>&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x901c &lt;*bar+28*>: ldi.s r2, 0x0 -> ldi.s r3, 0x0&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x9020 &lt;*bar+32*>: bra.l 0x9024 &lt;*bar+36*>&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x9024 &lt;*bar+36*>: add3 sp, r11, 0x2&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x9028 &lt;*bar+40*>: ld r11, @sp+ -> jmp r13&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>End of assembler dump.</b>&nbsp;</font></tt></pre>
</div>
</td>
</tr>
</table>

<div CLASS="Body"><font size=+1>Since the overlay containing <tt>bar</tt>
is not currently mapped, GDB finds <tt>bar</tt> at its load address, and
disassembles it there.</font></div>

<table BGCOLOR="#C0C0C0" >
<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>(gdb) </font></tt></b><tt><font size=+1>finish&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Run till exit from #0 foo (x=1) at foo.c:5&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x1000060 in main () at maindata.c:20&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>20 a = foo(1);&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Value returned is $3 = 324&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb)</b> next&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>21 OverlayLoad(1);&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>next&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>22 OverlayLoad(5);&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>next&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>23 b = bar(1);&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>overlay list&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Section .ovly1, loaded at 00009000 - 0000902c, mapped at 01001000 - 0100102c&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Section .data01, loaded at 0000d000 - 0000d004, mapped at 02001000 - 02001004&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>info symbol 0x1001000&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>foo in unmapped overlay section .ovly0&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>bar in mapped overlay section .ovly1&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>step&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>bar (x=1) at bar.c:6&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>6 if (x)&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>(gdb) x /i $pc&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>0x1001008 &lt;bar+8>: ld r2, @r11 -> cmpeqi.s r2, 0x0</b>&nbsp;</font></tt></pre>
</div>
</td>
</tr>
</table>

<div CLASS="Body"><font size=+1>Now <tt>bar</tt> is mapped, and <tt>foo</tt>
is not. Even though the PC is at the same address as before, GDB recognizes
that we are in <tt>bar</tt> rather than <tt>foo</tt>.</font></div>

<table CELLSPACING=0 CELLPADDING=0 BGCOLOR="#C0C0C0" >
<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>disassemble&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Dump of assembler code for function bar:&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x1001000 &lt;bar>: st r11, @-sp -> subi sp, 0x2&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x1001004 &lt;bar+4>: mv r11, sp -> st r2, @r11&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x1001008 &lt;bar+8>: ld r2, @r11 -> cmpeqi.s r2, 0x0&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x100100c &lt;bar+12>: brf0t.l 0x100101c &lt;bar+28>&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x1001010 &lt;bar+16>: ld2w r2, @(0x1000, r0)&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x1001014 &lt;bar+20>: bra.l 0x1001024 &lt;bar+36>&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x1001018 &lt;bar+24>: bra.l 0x1001024 &lt;bar+36>&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x100101c &lt;bar+28>: ldi.s r2, 0x0 -> ldi.s r3, 0x0&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x1001020 &lt;bar+32>: bra.l 0x1001024 &lt;bar+36>&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>0x1001024 &lt;bar+36>: add3 sp, r11, 0x2</b>&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x1001028 &lt;bar+40>: ld r11, @sp+ -> jmp r13&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>End of assembler dump.&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb)</b> finish&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Run till exit from #0 bar (x=1) at bar.c:5&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x100007c in main () at maindata.c:23&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>23 b = bar(1);&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>Value returned is $4 = 309</b>&nbsp;</font></tt></pre>
</div>
</td>
</tr>
</table>

<div CLASS="Body"><font size=+1>In the following example, the <tt>bazx</tt>
and <tt>grbxx</tt> variables are both mapped to the same runtime address.
We will see that with the automatic overlay debugging mode, GDB always
knows which variable is using that address.</font></div>

<table CELLSPACING=0 CELLPADDING=0 BGCOLOR="#C0C0C0" >
<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>info addr bazx&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Symbol "bazx" is static storage at address 0x2002000,&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>-- loaded at 0xe000 in overlay section .data02.&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>info sym 0x2002000&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>bazx in unmapped overlay section .data02&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>grbxx in unmapped overlay section .data03&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>info addr grbxx&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Symbol "grbxx" is static storage at address 0x2002000,&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>-- loaded at 0xf000 in overlay section .data03.&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>break baz&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Breakpoint 2 at 0x1002008: file baz.c, line 6.&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>break grbx&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>Breakpoint 3 at 0x1002008: file grbx.c, line 6.</b>&nbsp;</font></tt></pre>
</div>
</td>
</tr>
</table>

<div CLASS="Body"><font size=+1>Note that the two breakpoints are actually
set at the same address, yet GDB will correctly distinguish between them
when it hits them. If only one overlay function has a breakpoint on it,
GDB will not stop at that address in other overlay functions.</font></div>

<table CELLSPACING=0 CELLPADDING=0 BGCOLOR="#C0C0C0" >
<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>continue&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Continuing.&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Breakpoint 2, baz (x=1) at baz.c:6&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>6 if (x)&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>print &amp;bazx&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>$5 = (long int *) 0x2002000&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>x /d &amp;bazx&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x2002000 &lt;bazx>:317&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>print &amp;grbxx&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>$6 = (long int *) 0xf000&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>continue&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Continuing.&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>Breakpoint 3, grbx (x=1) at grbx.c:6&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>6 if (x)&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>print &amp;grbxx&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>$7 = (long int *) 0x2002000&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>x /d &amp;grbxx&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0x2002000 &lt;grbxx>:435&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb) </b>print &amp;bazx&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>$8 = (long int *) 0xe000</b>&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td></td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><tt><font size=+1><b>(gdb)</b> x /d &amp;bazx&nbsp;</font></tt></pre>
</div>
</td>
</tr>

<tr>
<td>
<div CLASS="CodeScreen">
<pre><b><tt><font size=+1>0xe000 &lt;*bazx*>:317&nbsp;</font></tt></b></pre>
</div>
</td>
</tr>
</table>


<p CLASS="Heading2"><a NAME="GDB_overlay_support"></a><b><i><font size=+2>GDB
overlay support</font></i></b>
<div CLASS="Body"><font size=+1>GDB provides special functionality for
debugging a program that is linked using the overlay mechanism of <tt>ld</tt>,
the GNU linker. In such programs, an overlay corresponds to a section with
a load address that is different from its runtime address. GDB can provide
<tt>manual</tt>
overlay debugging for any program linked in such a way (providing that
the overlays all reside somewhere in memory). <i>Automatic</i> overlay
debugging is also provided for the <b><i>Cygnus Sample Overlay Manager</i></b>.</font></div>

<div CLASS="BodyHang1">
<ul>
<ul>
<ul>
<ul>
<pre><tt><font size=+1>overlay manual</font></tt></pre>
</ul>
</ul>
</ul>
</ul>
</div>

<div CLASS="BodyHang1List">
<ul>
<ul>
<ul>
<ul>
<pre><font size=+1><tt>overlay map &lt;</tt> <i>section-name</i> <tt>></tt></font></pre>
</ul>
</ul>
</ul>
</ul>
</div>

<div CLASS="BodyHang1List">
<ul>
<ul>
<ul>
<ul>
<pre><font size=+1><tt>overlay unmap &lt;</tt> <i>section-name</i> <tt>></tt></font></pre>
</ul>
</ul>
</ul>
</ul>
</div>

<div CLASS="BodyHang1List">
<ul>
<ul>
<ul>
<ul>
<pre><tt><font size=+1>overlay list</font></tt></pre>
</ul>
</ul>
</ul>
</ul>
</div>

<div CLASS="BodyHang1List">
<ul>
<ul>
<ul>
<ul>
<pre><tt><font size=+1>overlay off</font></tt></pre>
</ul>
</ul>
</ul>
</ul>
</div>
<font size=+1>The manual mode requires input from the user to specify what
overlays are mapped into their runtime address regions at any given time.
The command ` <tt>OVERLAY MAP</tt> ' informs GDB that the overlay has been
mapped by the target into its shared runtime address range. The command
` <tt>overlay unmap</tt> ' informs GDB that the overlay is no longer resident
in its runtime address region, and must be accessed from the load-time
address region. If two overlays share the same runtime address region,
then mapping one implies unmapping the other.</font>
<div CLASS="BodyHang1">
<ul>
<ul>
<ul>
<ul>
<pre><tt><font size=+1>overlay auto</font></tt></pre>
</ul>
</ul>
</ul>
</ul>
</div>

<div CLASS="BodyHang1List">
<ul>
<ul>
<ul>
<ul>
<pre><tt><font size=+1>overlay list</font></tt></pre>
</ul>
</ul>
</ul>
</ul>
</div>

<div CLASS="BodyHang1List">
<ul>
<ul>
<ul>
<ul>
<pre><tt><font size=+1>overlay off</font></tt></pre>
</ul>
</ul>
</ul>
</ul>
</div>
<font size=+1>Automatic overlay debugging support in GDB works with the
runtime overlay manager provided in the <tt>examples</tt> directory.</font>
<p><font size=+1>When this mode is activated, GDB will automatically read
and interpret the data structures maintained in target memory by the overlay
manager. To learn what overlays are mapped at any time, use the command,
<tt>overlay
list</tt>. Whenever the target program is allowed to run (by the 
<tt>STEP</tt>
command), GDB will refresh its overlay map by reading from the target's
overlay tables.</font>
<p><font size=+1>The automatic mapping may be temporarily overridden by
the commands, <tt>overlay map</tt> and&nbsp; <tt>overlay unmap</tt>, but
these mappings will last only until the next time the target is allowed
to run. To explicitly take control of GDB's overlay mapping, switch to
the <tt>overlay manual</tt> mode.</font>

<p CLASS="Body"><font size=+1>When GDB's overlay support (either manual
or auto) is active, GDB's concept of a symbol's address is controlled by
which overlays are mapped into which memory regions. For instance, if you
use the command, <tt>PRINT</tt>, to get&nbsp; a variable that is in an
overlay which is currently mapped (that is located in its runtime address
region) GDB will fetch the variable's memory from the runtime address.
If the variable's overlay is currently not mapped, GDB will fetch it from
its load-time address.</font>

<p CLASS="Body"><font size=+1>Similarly, if you disassemble a function
that is in an unmapped overlay, or use a symbol's address to examine memory,
GDB will fetch the memory from the symbol's load-time address range instead
of the runtime range. If GDB's output contains labels that are relative
to an overlay's load-time address instead of the runtime address, the labels
will be distinguished like this:</font>
<ul>
<pre CLASS="CodeExample"><tt><font size=+1><b>(gdb) </b>overlay map .ovly0</font></tt></pre>

<pre><tt><font size=+1><b>(gdb) </b>x /x foo</font></tt></pre>

<pre><b><tt><font size=+1>0x1001000 &lt;foo>: 0x76bf81e5</font></tt></b></pre>

<pre><tt><font size=+1><b>(gdb) </b>overlay unmap .ovly0</font></tt></pre>

<pre><tt><font size=+1><b>(gdb) </b>x /x foo</font></tt></pre>

<pre><b><tt><font size=+1>0x8000 &lt;*foo*>: 0x76bf81e5</font></tt></b></pre>
</ul>

<div CLASS="Body"><font size=+1>The extra asterisks around the label, <tt>foo</tt>,
may be interpreted as meaning that this is where <tt>foo</tt> is presently,
but not where it will be when it is in use by the target program.</font></div>

<div CLASS="Body"><font size=+1>The <tt>info address</tt> command can tell
you what overlay a symbol is in, as well as where it is loaded and mapped.
The <tt>info symbol</tt> command can list all of the symbols that are mapped
to an address.</font></div>

<br>&nbsp;
<ul>
<ul>
<pre CLASS="CodeExample"><b>(gdb) </b>info address foo</pre>

<pre><b>Symbol "foo" is a function at address 0x1001000</b></pre>

<pre><b>-- loaded at 0x8000 in overlay section .ovly0.</b></pre>

<pre><b>(gdb) </b>info symbol 0x1001000</pre>

<pre><b>foo in mapped overlay section .ovly0</b></pre>

<pre><b>bar in unmapped overlay section .ovly1</b></pre>
</ul>
</ul>

<div CLASS="Heading2"><a NAME="Breakpoints"></a><b><i><font size=+2>Breakpoints</font></i></b></div>

<div CLASS="Body"><font size=+1>So long as the overlay sections are located
in RAM rather than ROM, GDB can set breakpoints in them. The breakpoints
work by inserting trap instructions into the load-time address region.
When the overlay is mapped into the runtime region, the trap instructions
are mapped along with it, and when executed, cause the target program to
break out to the debugger. If the overlay regions are located in ROM, you
can only set breakpoints in them after they have been mapped into the runtime
region in RAM.</font></div>

<div CLASS="Body">
<hr SIZE=3 WIDTH="100%"></div>

<center><a href="#Top">Top</a>|<a href="emb.html">Contents</a>|<a href="embvrxxxx.html">Previous</a>|<a href="m32r.html#Top">Next</a></center>

</body>
</html>
