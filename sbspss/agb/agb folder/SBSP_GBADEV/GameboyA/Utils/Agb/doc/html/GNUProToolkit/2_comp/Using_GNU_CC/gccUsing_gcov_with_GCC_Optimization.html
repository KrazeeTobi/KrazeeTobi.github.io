<HTML>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
   <META NAME="GENERATOR" CONTENT="Mozilla/4.04 [en] (Win95; I) [Netscape]">
   <TITLE>Using gcov with GCC Optimization</TITLE>
</HEAD>
<BODY>
<A HREF="gcc.html">Contents</A>|<A HREF="gccindex.html">Index</A>|<A HREF="gccInvoking_gcov.html">Previous</A>|<A HREF="gccBrief_description_of_gcov_data_f.html">Next</A>
<BR><FONT COLOR="#000000"><FONT FACE="Futura Md BT">&nbsp;<A NAME="off_4620288"></A><A NAME="65e5d957"></A><B><FONT SIZE=+3>Using
</FONT></B></FONT><B><TT><FONT POINT-SIZE="24">gcov</FONT></TT><FONT FACE="Futura Md BT"><FONT SIZE=+3>
with GCC optimization&nbsp;</FONT></FONT></B><FONT FACE="Futura Md BT">&nbsp;</FONT></FONT>
<HR SIZE=6 WIDTH="100%">
<BR><FONT FACE="Times New Roman"><FONT SIZE=+1>If you plan to use </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>gcov</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>
to help optimize your code, you must first compile your program with two
options: ‘</FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>-fprofile-arcs</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>’
and ‘</FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>-ftest-coverage</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>’.
Aside from that, you can use any other GNU CC options; but if you want
to prove that every single line in your program was executed, you should
not compile with optimization at the same time. On some machines the optimizer
can eliminate some simple code lines by combining them with other lines.
For example, code like the following can be compiled into one instruction
on some machines.</FONT></FONT>
<UL>
<PRE><FONT FACE="Courier New"><FONT SIZE=+1>if (a != b)&nbsp;
&nbsp;&nbsp; c =1;&nbsp;
else&nbsp;
&nbsp;&nbsp; c =0;</FONT></FONT></PRE>
</UL>
<FONT FACE="Times New Roman"><FONT SIZE=+1>In this case, there is no way
for </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>gcov </FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>to
calculate separate execution counts for each line because there isn’t separate
code for each line. Hence, the </FONT></FONT><FONT FACE="Courier New"><FONT SIZE=+0>gcov
</FONT></FONT><FONT FACE="Times New Roman"><FONT SIZE=+1>output looks like
this if you compiled the program with optimization.</FONT></FONT>
<UL><FONT FACE="Courier New"><FONT SIZE=+1>100 if (a != b)</FONT></FONT>
<BR><FONT FACE="Courier New"><FONT SIZE=+1>100 c = 1;</FONT></FONT>
<BR><FONT FACE="Courier New"><FONT SIZE=+1>100 else</FONT></FONT>
<BR><FONT FACE="Courier New"><FONT SIZE=+1>100 c = 0;</FONT></FONT></UL>
<FONT FACE="Times New Roman"><FONT SIZE=+1>The output shows that this block
of code, combined by optimization, executed 100 times. In one sense this
result is correct, because there was only one instruction representing
all four of these lines. However, the output does not indicate how many
times the result was 0 and how many times the result was 1.</FONT></FONT>
</BODY>
</HTML>
